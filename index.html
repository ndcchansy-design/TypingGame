<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Defense - English Typing Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes zombieApproach {
            0% {
                transform: translateZ(-1000px) scale(0.1) translateX(0px) rotate(0deg);
                opacity: 0.3;
            }
            10% {
                transform: translateZ(-800px) scale(0.2) translateX(-10px) rotate(-2deg);
                opacity: 0.4;
            }
            20% {
                transform: translateZ(-600px) scale(0.35) translateX(8px) rotate(1deg);
                opacity: 0.5;
            }
            30% {
                transform: translateZ(-400px) scale(0.5) translateX(-15px) rotate(-1.5deg);
                opacity: 0.6;
            }
            40% {
                transform: translateZ(-200px) scale(0.7) translateX(12px) rotate(2deg);
                opacity: 0.75;
            }
            50% {
                transform: translateZ(-100px) scale(0.85) translateX(-8px) rotate(-0.5deg);
                opacity: 0.85;
            }
            60% {
                transform: translateZ(-50px) scale(1.0) translateX(5px) rotate(1deg);
                opacity: 0.9;
            }
            70% {
                transform: translateZ(-25px) scale(1.1) translateX(-7px) rotate(-1deg);
                opacity: 0.95;
            }
            80% {
                transform: translateZ(-10px) scale(1.25) translateX(3px) rotate(0.5deg);
                opacity: 0.98;
            }
            90% {
                transform: translateZ(-5px) scale(1.35) translateX(-2px) rotate(-0.5deg);
                opacity: 1;
            }
            100% {
                transform: translateZ(0) scale(1.5) translateX(0px) rotate(0deg);
                opacity: 1;
            }
        }

        /* Zombie 1 - 直线前进，轻微摇摆 */
        @keyframes zombie1Approach {
            0% {
                transform: translateZ(-1000px) scale(0.8) translateX(0px) rotate(0deg);
                opacity: 0.3;
            }
            100% {
                transform: translateZ(0) scale(1.5) translateX(0px) rotate(0deg);
                opacity: 1;
            }
        }

        /* Zombie 2 - 左右摇摆前进 */
        @keyframes zombie2Approach {
            0% {
                transform: translateZ(-1000px) scale(0.8) translateX(-30px) rotate(-5deg);
                opacity: 0.3;
            }
            25% {
                transform: translateZ(-750px) scale(0.95) translateX(30px) rotate(5deg);
                opacity: 0.5;
            }
            50% {
                transform: translateZ(-500px) scale(1.1) translateX(-30px) rotate(-5deg);
                opacity: 0.7;
            }
            75% {
                transform: translateZ(-250px) scale(1.3) translateX(30px) rotate(5deg);
                opacity: 0.9;
            }
            100% {
                transform: translateZ(0) scale(1.5) translateX(0px) rotate(0deg);
                opacity: 1;
            }
        }

        /* Zombie 3 - 快速冲刺，抖动前进 */
        @keyframes zombie3Approach {
            0% {
                transform: translateZ(-1000px) scale(0.8) translateX(0px) rotate(0deg);
                opacity: 0.3;
            }
            10% {
                transform: translateZ(-700px) scale(0.9) translateX(-5px) rotate(-2deg);
                opacity: 0.5;
            }
            20% {
                transform: translateZ(-500px) scale(1.0) translateX(5px) rotate(2deg);
                opacity: 0.65;
            }
            30% {
                transform: translateZ(-350px) scale(1.1) translateX(-5px) rotate(-2deg);
                opacity: 0.8;
            }
            50% {
                transform: translateZ(-150px) scale(1.3) translateX(5px) rotate(2deg);
                opacity: 0.9;
            }
            70% {
                transform: translateZ(-50px) scale(1.4) translateX(-3px) rotate(-1deg);
                opacity: 0.95;
            }
            100% {
                transform: translateZ(0) scale(1.5) translateX(0px) rotate(0deg);
                opacity: 1;
            }
        }

        .zombie-word {
            perspective: 1000px;
            transform-style: preserve-3d;
            filter: drop-shadow(2px 2px 8px rgba(0,0,0,0.8));
        }

        .zombie-word.zombie1 {
            animation: zombie1Approach linear;
        }

        .zombie-word.zombie2 {
            animation: zombie2Approach linear;
        }

        .zombie-word.zombie3 {
            animation: zombie3Approach linear;
        }

        @keyframes zombieStagger {
            0% { transform: translateX(0px) rotate(0deg); }
            25% { transform: translateX(-3px) rotate(-1deg); }
            50% { transform: translateX(2px) rotate(1deg); }
            75% { transform: translateX(-1px) rotate(-0.5deg); }
            100% { transform: translateX(0px) rotate(0deg); }
        }

        .zombie-idle {
            animation: zombieStagger 2s ease-in-out infinite;
        }

        @keyframes hitStun {
            0% {
                transform: translateZ(0px) scale(1);
                filter: brightness(1) hue-rotate(0deg) drop-shadow(2px 2px 8px rgba(0,0,0,0.8));
            }
            50% {
                transform: translateZ(0px) scale(1);
                filter: brightness(1.8) hue-rotate(0deg) drop-shadow(0 0 15px #ffff00);
            }
            100% {
                transform: translateZ(0px) scale(1);
                filter: brightness(1) hue-rotate(0deg) drop-shadow(2px 2px 8px rgba(0,0,0,0.8));
            }
        }

        @keyframes hitKnockback {
            0% {
                transform: translateZ(0px) scale(1) rotate(0deg);
                filter: brightness(1) drop-shadow(2px 2px 8px rgba(0,0,0,0.8));
                animation-play-state: running;
            }
            50% {
                transform: translateZ(-120px) scale(0.8) rotate(-3deg);
                filter: brightness(1.8) drop-shadow(0 0 15px #ff4444);
                animation-play-state: running;
            }
            100% {
                transform: translateZ(-120px) scale(0.8) rotate(0deg);
                filter: brightness(1) drop-shadow(2px 2px 8px rgba(0,0,0,0.8));
                animation-play-state: paused;
            }
        }

        .hit-stun {
            animation: hitStun 0.3s ease-out !important;
            animation-fill-mode: forwards !important;
        }

        .hit-knockback {
            animation: hitKnockback 0.6s ease-out !important;
            animation-fill-mode: forwards !important;
        }

        @keyframes zombieDeath {
            0% {
                transform: scale(1) rotate(0deg);
                filter: brightness(1) drop-shadow(2px 2px 8px rgba(0,0,0,0.8));
                opacity: 1;
            }
            25% {
                transform: scale(1.1) rotate(-5deg);
                filter: brightness(2) hue-rotate(0deg) drop-shadow(0 0 20px #ff0000);
                opacity: 1;
            }
            50% {
                transform: scale(0.9) rotate(5deg);
                filter: brightness(1.5) hue-rotate(30deg) drop-shadow(0 0 15px #ff0000);
                opacity: 0.8;
            }
            75% {
                transform: scale(0.7) rotate(-10deg);
                filter: brightness(0.5) hue-rotate(60deg) drop-shadow(0 0 10px #ff0000);
                opacity: 0.4;
            }
            100% {
                transform: scale(0.3) rotate(15deg);
                filter: brightness(0) grayscale(1);
                opacity: 0;
            }
        }

        .zombie-death {
            animation: zombieDeath 0.8s ease-out forwards !important;
        }

        .letter {
            display: inline-block;
            transition: all 0.2s ease;
        }

        .letter.typed {
            background: #10b981;
            color: white;
            border-radius: 4px;
            padding: 0 2px;
        }

        .letter.current {
            background: #f59e0b;
            color: white;
            border-radius: 4px;
            padding: 0 2px;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .shake {
            animation: shake 0.3s ease-in-out;
        }

        @keyframes pulse-success {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .pulse-success {
            animation: pulse-success 0.3s ease-in-out;
        }

        @keyframes hpDamage {
            0% {
                filter: brightness(1);
                transform: scale(1);
            }
            25% {
                filter: brightness(2) drop-shadow(0 0 10px #ff0000);
                transform: scale(1.1);
            }
            50% {
                filter: brightness(0.5);
                transform: scale(0.95);
            }
            100% {
                filter: brightness(1);
                transform: scale(1);
            }
        }

        @keyframes hpHeal {
            0% {
                filter: brightness(1);
                transform: scale(1);
            }
            50% {
                filter: brightness(2) drop-shadow(0 0 15px #00ff00);
                transform: scale(1.15);
            }
            100% {
                filter: brightness(1);
                transform: scale(1);
            }
        }

        .hp-damage {
            animation: hpDamage 0.5s ease-out;
        }

        .hp-heal {
            animation: hpHeal 0.6s ease-out;
        }

        @keyframes itemDrop {
            0% {
                opacity: 0;
                transform: translateY(-50px) scale(0.5) rotate(0deg);
            }
            60% {
                opacity: 1;
                transform: translateY(0px) scale(1.2) rotate(180deg);
            }
            80% {
                transform: scale(0.9) rotate(360deg);
            }
            100% {
                transform: scale(1) rotate(360deg);
            }
        }

        .health-item {
            position: absolute;
            width: 100px;
            height: 100px;
            animation: itemDrop 0.8s ease-out, itemFloat 2s ease-in-out infinite;
            filter: drop-shadow(0 0 15px rgba(0, 255, 0, 0.9));
            z-index: 5;
            pointer-events: none;
        }

        .health-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        @keyframes itemFloat {
            0%, 100% {
                transform: translateY(0px) scale(1) rotate(0deg);
                filter: drop-shadow(0 0 15px rgba(0, 255, 0, 0.9)) brightness(1);
            }
            25% {
                transform: translateY(-8px) scale(1.05) rotate(5deg);
                filter: drop-shadow(0 0 25px rgba(0, 255, 0, 1)) brightness(1.2);
            }
            50% {
                transform: translateY(0px) scale(1.1) rotate(0deg);
                filter: drop-shadow(0 0 30px rgba(0, 255, 0, 1)) brightness(1.3);
            }
            75% {
                transform: translateY(-8px) scale(1.05) rotate(-5deg);
                filter: drop-shadow(0 0 25px rgba(0, 255, 0, 1)) brightness(1.2);
            }
        }

        @keyframes collectItem {
            0% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: scale(1.5) rotate(180deg);
                opacity: 0.8;
                filter: drop-shadow(0 0 40px rgba(0, 255, 0, 1)) brightness(2);
            }
            100% {
                transform: scale(0.2) translateY(-150px) rotate(360deg);
                opacity: 0;
                filter: drop-shadow(0 0 50px rgba(0, 255, 0, 1)) brightness(3);
            }
        }

        .collecting {
            animation: collectItem 0.8s ease-out forwards !important;
        }

        @keyframes itemSparkle {
            0%, 100% {
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
        }

        .health-item::before {
            content: '';
            position: absolute;
            top: -5px;
            right: -5px;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, #fff, #0f0);
            border-radius: 50%;
            animation: itemSparkle 1s ease-in-out infinite;
        }

        .health-item::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: -5px;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #fff, #0f0);
            border-radius: 50%;
            animation: itemSparkle 1s ease-in-out infinite 0.5s;
        }

        .zombie-container {
            position: relative;
            display: inline-block;
        }

        .zombie-image {
            display: block;
            width: 10vw;
            height: 17.5vw;
            object-fit: contain;
        }

        .zombie-text-overlay {
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            border: 0.2vw solid #333;
            border-radius: 0.8vw;
            padding: 0.8vw 1.2vw;
            box-shadow: 0 0.2vw 0.8vw rgba(0,0,0,0.3);
            min-width: 12vw;
            max-width: 30vw;
            text-align: center;
            font-size: 1.2vw;
            white-space: nowrap;
            overflow: visible;
        }

        .dark .zombie-text-overlay {
            background: rgba(31, 41, 55, 0.95);
            border-color: #9ca3af;
        }

        #gameArea {
            background-image: url('images/IMG_2669.PNG');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white font-mono overflow-hidden">
    <!-- Dark mode detection -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <!-- Game Container -->
    <div class="h-screen relative overflow-hidden">
        <!-- Header Stats -->
        <div class="absolute top-0 left-0 right-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm p-4">
            <div class="flex justify-between items-center max-w-6xl mx-auto">
                <div class="flex space-x-6">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-primary" id="score">0</div>
                        <div class="text-xs text-gray-600 dark:text-gray-400">SCORE</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-500" id="wpm">0</div>
                        <div class="text-xs text-gray-600 dark:text-gray-400">WPM</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-500" id="accuracy">100%</div>
                        <div class="text-xs text-gray-600 dark:text-gray-400">ACCURACY</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-purple-500" id="level">1</div>
                        <div class="text-xs text-gray-600 dark:text-gray-400">LEVEL</div>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-center min-w-[200px]">
                        <div class="relative w-48 h-6 bg-gray-300 dark:bg-gray-700 rounded-full overflow-hidden border-2 border-gray-400 dark:border-gray-500">
                            <div id="hpBar" class="absolute top-0 left-0 h-full bg-gradient-to-r from-red-500 to-red-600 transition-all duration-300 ease-out" style="width: 100%"></div>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span class="text-xs font-bold text-white drop-shadow-lg" id="hpText">100 / 100</span>
                            </div>
                        </div>
                        <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">HEALTH</div>
                    </div>
                    <div class="text-center">
                        <div class="text-sm font-bold text-orange-500" id="wordSource">DEFAULT</div>
                        <div class="text-xs text-gray-600 dark:text-gray-400">WORDS</div>
                    </div>
                    <div class="text-center">
                        <div class="text-sm font-bold text-purple-500" id="gameMode">NORMAL</div>
                        <div class="text-xs text-gray-600 dark:text-gray-400">MODE</div>
                    </div>
                    <button id="translationBtn" class="px-3 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors text-sm">
                        中文 ON
                    </button>
                    <button id="pauseBtn" class="px-4 py-2 bg-primary text-white rounded hover:bg-primary/80 transition-colors">
                        PAUSE
                    </button>
                    <button id="musicBtn" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors">
                        🔊 MUSIC
                    </button>
                </div>
            </div>
        </div>

        <!-- Background Music -->
        <audio id="bgMusic" loop>
            <source src="Audio/殭屍末日狂打.mp3" type="audio/mpeg">
        </audio>

        <!-- Typing Sound Effect -->
        <audio id="gunshotSound" preload="auto">
            <source src="Sound/Gunshot.wav" type="audio/wav">
        </audio>

        <!-- Game Area -->
        <div id="gameArea" class="h-full relative">
            <!-- Falling zombie words will be added here -->
        </div>

        <!-- Input Area -->
        <div class="absolute bottom-0 left-0 right-0 z-10 bg-white/90 dark:bg-gray-900/90 backdrop-blur-sm p-4">
            <div class="max-w-2xl mx-auto">
                <input
                    type="text"
                    id="wordInput"
                    class="w-full text-2xl p-4 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:border-primary focus:outline-none transition-colors text-base"
                    placeholder="Type the words here..."
                    autocomplete="off"
                    spellcheck="false"
                >
                <div class="mt-2 text-center text-gray-600 dark:text-gray-400">
                    <span id="currentTarget">Start typing to begin!</span>
                </div>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="gameOverScreen" class="absolute inset-0 bg-black/80 flex items-center justify-center z-20 hidden">
            <div class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-2xl text-center max-w-md mx-4">
                <h2 class="text-3xl font-bold mb-4 text-red-500">GAME OVER</h2>
                <div class="space-y-2 mb-6">
                    <p class="text-xl">Final Score: <span id="finalScore" class="font-bold text-primary">0</span></p>
                    <p>Words Per Minute: <span id="finalWpm" class="font-bold text-green-500">0</span></p>
                    <p>Accuracy: <span id="finalAccuracy" class="font-bold text-blue-500">0%</span></p>
                    <p>Level Reached: <span id="finalLevel" class="font-bold text-purple-500">1</span></p>
                </div>
                <button id="restartBtn" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/80 transition-colors">
                    PLAY AGAIN
                </button>
            </div>
        </div>

        <!-- Pause Screen -->
        <div id="pauseScreen" class="absolute inset-0 bg-black/80 flex items-center justify-center z-20 hidden">
            <div class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-2xl text-center">
                <h2 class="text-3xl font-bold mb-6">PAUSED</h2>
                <button id="resumeBtn" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/80 transition-colors">
                    RESUME
                </button>
            </div>
        </div>

        <!-- Start Screen -->
        <div id="startScreen" class="absolute inset-0 bg-gradient-to-br from-primary/20 to-purple-500/20 flex items-center justify-center z-20">
            <div class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-2xl text-center max-w-lg mx-4">
                <h1 class="text-4xl font-bold mb-4 text-primary">TYPING DEFENSE</h1>
                <p class="text-gray-600 dark:text-gray-400 mb-6">
                    Type the approaching words to destroy the zombies before they get too close!<br>
                    Three types of zombies with different movement patterns. Lose all 3 lives and it's game over.
                </p>
                <div class="text-left mb-6 text-sm space-y-1">
                    <p><strong>Controls:</strong></p>
                    <p>• Type words letter by letter</p>
                    <p>• Green = typed correctly, Yellow = current letter</p>
                    <p>• Higher levels = faster zombies</p>
                    <p>• Longer words = more points</p>
                    <p>• Press Escape to clear input</p>
                </div>

                <!-- CSV Upload Section -->
                <div class="mb-6 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">
                    <h3 class="text-lg font-bold mb-3">Custom Word List</h3>
                    <div class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                        Upload a CSV file with your own words and translations.<br>
                        Format: <code class="bg-gray-200 dark:bg-gray-600 px-1 rounded">word,translation</code>
                    </div>
                    <div class="flex flex-col space-y-3">
                        <input
                            type="file"
                            id="csvFileInput"
                            accept=".csv,.txt"
                            class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-primary/80"
                        >
                        <div class="flex space-x-2">
                            <button id="loadCsvBtn" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors text-sm">
                                LOAD CSV
                            </button>
                            <button id="clearCsvBtn" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors text-sm">
                                USE DEFAULT
                            </button>
                        </div>
                        <div id="csvStatus" class="text-sm"></div>
                    </div>
                </div>

                <!-- Game Mode Selection -->
                <div id="gameModeSection" class="mb-6 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg hidden">
                    <h3 class="text-lg font-bold mb-3">Game Mode</h3>
                    <div class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                        Choose your game mode with custom words.
                    </div>
                    <div class="flex space-x-3">
                        <button id="normalModeBtn" class="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors text-sm">
                            NORMAL MODE
                        </button>
                        <button id="dictationModeBtn" class="px-4 py-2 bg-pink-500 text-white rounded hover:bg-pink-600 transition-colors text-sm">
                            DICTATION MODE
                        </button>
                    </div>
                    <div class="mt-2 text-xs text-gray-600 dark:text-gray-400">
                        Normal: Type English words | Dictation: See Chinese, type English
                    </div>
                </div>

                <button id="startBtn" class="px-8 py-4 bg-primary text-white text-xl rounded-lg hover:bg-primary/80 transition-colors">
                    START GAME
                </button>
            </div>
        </div>
    </div>

    <script>
        class TypingGame {
            constructor() {
                this.words = [
                    // Easy words (3-5 letters) - 300 words
                    { word: 'cat', translation: '貓' },
                    { word: 'dog', translation: '狗' },
                    { word: 'run', translation: '跑' },
                    { word: 'jump', translation: '跳' },
                    { word: 'walk', translation: '走' },
                    { word: 'talk', translation: '說話' },
                    { word: 'read', translation: '讀' },
                    { word: 'book', translation: '書' },
                    { word: 'play', translation: '玩' },
                    { word: 'game', translation: '遊戲' },
                    { word: 'fire', translation: '火' },
                    { word: 'water', translation: '水' },
                    { word: 'earth', translation: '地球' },
                    { word: 'wind', translation: '風' },
                    { word: 'light', translation: '光' },
                    { word: 'dark', translation: '暗' },
                    { word: 'fast', translation: '快' },
                    { word: 'slow', translation: '慢' },
                    { word: 'big', translation: '大' },
                    { word: 'small', translation: '小' },
                    { word: 'happy', translation: '快樂' },
                    { word: 'angry', translation: '生氣' },
                    { word: 'quick', translation: '迅速' },
                    { word: 'brown', translation: '棕色' },
                    { word: 'black', translation: '黑色' },
                    { word: 'white', translation: '白色' },
                    { word: 'green', translation: '綠色' },
                    { word: 'music', translation: '音樂' },
                    { word: 'dance', translation: '跳舞' },
                    { word: 'write', translation: '寫' },
                    { word: 'bird', translation: '鳥' },
                    { word: 'fish', translation: '魚' },
                    { word: 'tree', translation: '樹' },
                    { word: 'sun', translation: '太陽' },
                    { word: 'moon', translation: '月亮' },
                    { word: 'star', translation: '星星' },
                    { word: 'rain', translation: '雨' },
                    { word: 'snow', translation: '雪' },
                    { word: 'cloud', translation: '雲' },
                    { word: 'house', translation: '房子' },
                    { word: 'home', translation: '家' },
                    { word: 'door', translation: '門' },
                    { word: 'chair', translation: '椅子' },
                    { word: 'table', translation: '桌子' },
                    { word: 'bed', translation: '床' },
                    { word: 'room', translation: '房間' },
                    { word: 'wall', translation: '牆' },
                    { word: 'floor', translation: '地板' },
                    { word: 'roof', translation: '屋頂' },
                    { word: 'car', translation: '汽車' },
                    { word: 'bus', translation: '公車' },
                    { word: 'train', translation: '火車' },
                    { word: 'plane', translation: '飛機' },
                    { word: 'boat', translation: '船' },
                    { word: 'bike', translation: '腳踏車' },
                    { word: 'road', translation: '道路' },
                    { word: 'path', translation: '小徑' },
                    { word: 'city', translation: '城市' },
                    { word: 'town', translation: '城鎮' },
                    { word: 'shop', translation: '商店' },
                    { word: 'park', translation: '公園' },
                    { word: 'food', translation: '食物' },
                    { word: 'rice', translation: '米飯' },
                    { word: 'bread', translation: '麵包' },
                    { word: 'meat', translation: '肉' },
                    { word: 'milk', translation: '牛奶' },
                    { word: 'egg', translation: '蛋' },
                    { word: 'fruit', translation: '水果' },
                    { word: 'apple', translation: '蘋果' },
                    { word: 'grape', translation: '葡萄' },
                    { word: 'lemon', translation: '檸檬' },
                    { word: 'peach', translation: '桃子' },
                    { word: 'tea', translation: '茶' },
                    { word: 'drink', translation: '飲料' },
                    { word: 'eat', translation: '吃' },
                    { word: 'cook', translation: '煮' },
                    { word: 'hand', translation: '手' },
                    { word: 'foot', translation: '腳' },
                    { word: 'head', translation: '頭' },
                    { word: 'face', translation: '臉' },
                    { word: 'eye', translation: '眼睛' },
                    { word: 'ear', translation: '耳朵' },
                    { word: 'nose', translation: '鼻子' },
                    { word: 'mouth', translation: '嘴巴' },
                    { word: 'hair', translation: '頭髮' },
                    { word: 'arm', translation: '手臂' },
                    { word: 'leg', translation: '腿' },
                    { word: 'body', translation: '身體' },
                    { word: 'bone', translation: '骨頭' },
                    { word: 'skin', translation: '皮膚' },
                    { word: 'red', translation: '紅色' },
                    { word: 'blue', translation: '藍色' },
                    { word: 'gray', translation: '灰色' },
                    { word: 'pink', translation: '粉紅色' },
                    { word: 'gold', translation: '金色' },
                    { word: 'cold', translation: '冷' },
                    { word: 'hot', translation: '熱' },
                    { word: 'warm', translation: '溫暖' },
                    { word: 'cool', translation: '涼爽' },
                    { word: 'new', translation: '新的' },
                    { word: 'old', translation: '舊的' },
                    { word: 'good', translation: '好的' },
                    { word: 'bad', translation: '壞的' },
                    { word: 'high', translation: '高' },
                    { word: 'low', translation: '低' },
                    { word: 'long', translation: '長' },
                    { word: 'short', translation: '短' },
                    { word: 'wide', translation: '寬' },
                    { word: 'thin', translation: '瘦' },
                    { word: 'thick', translation: '厚' },
                    { word: 'clean', translation: '乾淨' },
                    { word: 'dirty', translation: '髒' },
                    { word: 'left', translation: '左邊' },
                    { word: 'right', translation: '右邊' },
                    { word: 'front', translation: '前面' },
                    { word: 'back', translation: '後面' },
                    { word: 'top', translation: '頂部' },
                    { word: 'side', translation: '旁邊' },
                    { word: 'near', translation: '近' },
                    { word: 'far', translation: '遠' },
                    { word: 'up', translation: '上' },
                    { word: 'down', translation: '下' },
                    { word: 'here', translation: '這裡' },
                    { word: 'there', translation: '那裡' },
                    { word: 'love', translation: '愛' },
                    { word: 'hate', translation: '恨' },
                    { word: 'like', translation: '喜歡' },
                    { word: 'want', translation: '想要' },
                    { word: 'need', translation: '需要' },
                    { word: 'help', translation: '幫助' },
                    { word: 'give', translation: '給' },
                    { word: 'take', translation: '拿' },
                    { word: 'bring', translation: '帶來' },
                    { word: 'buy', translation: '買' },
                    { word: 'sell', translation: '賣' },
                    { word: 'open', translation: '打開' },
                    { word: 'close', translation: '關閉' },
                    { word: 'push', translation: '推' },
                    { word: 'pull', translation: '拉' },
                    { word: 'send', translation: '送' },
                    { word: 'get', translation: '得到' },
                    { word: 'make', translation: '製作' },
                    { word: 'break', translation: '打破' },
                    { word: 'fix', translation: '修理' },
                    { word: 'find', translation: '找到' },
                    { word: 'lose', translation: '失去' },
                    { word: 'show', translation: '展示' },
                    { word: 'hide', translation: '隱藏' },
                    { word: 'see', translation: '看見' },
                    { word: 'hear', translation: '聽到' },
                    { word: 'feel', translation: '感覺' },
                    { word: 'smell', translation: '聞' },
                    { word: 'taste', translation: '嚐' },
                    { word: 'know', translation: '知道' },
                    { word: 'think', translation: '想' },
                    { word: 'hope', translation: '希望' },
                    { word: 'wish', translation: '願望' },
                    { word: 'dream', translation: '夢想' },
                    { word: 'sleep', translation: '睡覺' },
                    { word: 'wake', translation: '醒來' },
                    { word: 'work', translation: '工作' },
                    { word: 'rest', translation: '休息' },
                    { word: 'study', translation: '學習' },
                    { word: 'teach', translation: '教' },
                    { word: 'learn', translation: '學' },
                    { word: 'test', translation: '測試' },
                    { word: 'pass', translation: '通過' },
                    { word: 'fail', translation: '失敗' },
                    { word: 'try', translation: '嘗試' },
                    { word: 'win', translation: '贏' },
                    { word: 'draw', translation: '畫' },
                    { word: 'paint', translation: '繪畫' },
                    { word: 'sing', translation: '唱歌' },
                    { word: 'laugh', translation: '笑' },
                    { word: 'cry', translation: '哭' },
                    { word: 'smile', translation: '微笑' },
                    { word: 'call', translation: '打電話' },
                    { word: 'ask', translation: '問' },
                    { word: 'tell', translation: '告訴' },
                    { word: 'say', translation: '說' },
                    { word: 'speak', translation: '講' },
                    { word: 'shout', translation: '喊' },
                    { word: 'wait', translation: '等待' },
                    { word: 'stop', translation: '停止' },
                    { word: 'start', translation: '開始' },
                    { word: 'go', translation: '去' },
                    { word: 'come', translation: '來' },
                    { word: 'stay', translation: '停留' },
                    { word: 'leave', translation: '離開' },
                    { word: 'stand', translation: '站' },
                    { word: 'sit', translation: '坐' },
                    { word: 'fly', translation: '飛' },
                    { word: 'swim', translation: '游泳' },
                    { word: 'climb', translation: '爬' },
                    { word: 'fall', translation: '掉落' },
                    { word: 'rise', translation: '上升' },
                    { word: 'grow', translation: '成長' },
                    { word: 'cut', translation: '切' },
                    { word: 'hit', translation: '打' },
                    { word: 'kick', translation: '踢' },
                    { word: 'throw', translation: '扔' },
                    { word: 'catch', translation: '接住' },
                    { word: 'hold', translation: '握住' },
                    { word: 'touch', translation: '觸摸' },
                    { word: 'wear', translation: '穿' },
                    { word: 'use', translation: '使用' },
                    { word: 'turn', translation: '轉' },
                    { word: 'move', translation: '移動' },
                    { word: 'man', translation: '男人' },
                    { word: 'boy', translation: '男孩' },
                    { word: 'girl', translation: '女孩' },
                    { word: 'child', translation: '孩子' },
                    { word: 'baby', translation: '嬰兒' },
                    { word: 'dad', translation: '爸爸' },
                    { word: 'mom', translation: '媽媽' },
                    { word: 'son', translation: '兒子' },
                    { word: 'king', translation: '國王' },
                    { word: 'queen', translation: '女王' },
                    { word: 'name', translation: '名字' },
                    { word: 'age', translation: '年齡' },
                    { word: 'year', translation: '年' },
                    { word: 'day', translation: '天' },
                    { word: 'week', translation: '週' },
                    { word: 'month', translation: '月' },
                    { word: 'hour', translation: '小時' },
                    { word: 'time', translation: '時間' },
                    { word: 'clock', translation: '時鐘' },
                    { word: 'watch', translation: '手錶' },
                    { word: 'now', translation: '現在' },
                    { word: 'today', translation: '今天' },
                    { word: 'past', translation: '過去' },
                    { word: 'late', translation: '晚' },
                    { word: 'early', translation: '早' },
                    { word: 'one', translation: '一' },
                    { word: 'two', translation: '二' },
                    { word: 'three', translation: '三' },
                    { word: 'four', translation: '四' },
                    { word: 'five', translation: '五' },
                    { word: 'six', translation: '六' },
                    { word: 'seven', translation: '七' },
                    { word: 'eight', translation: '八' },
                    { word: 'nine', translation: '九' },
                    { word: 'ten', translation: '十' },
                    { word: 'first', translation: '第一' },
                    { word: 'last', translation: '最後' },
                    { word: 'next', translation: '下一個' },
                    { word: 'some', translation: '一些' },
                    { word: 'many', translation: '很多' },
                    { word: 'few', translation: '少數' },
                    { word: 'all', translation: '全部' },
                    { word: 'none', translation: '沒有' },
                    { word: 'much', translation: '許多' },
                    { word: 'more', translation: '更多' },
                    { word: 'less', translation: '更少' },
                    { word: 'most', translation: '最多' },
                    { word: 'best', translation: '最好' },
                    { word: 'same', translation: '相同' },
                    { word: 'half', translation: '一半' },
                    { word: 'full', translation: '滿的' },
                    { word: 'empty', translation: '空的' },
                    { word: 'true', translation: '真的' },
                    { word: 'false', translation: '假的' },
                    { word: 'real', translation: '真實' },
                    { word: 'safe', translation: '安全' },
                    { word: 'easy', translation: '簡單' },
                    { word: 'hard', translation: '困難' },
                    { word: 'loud', translation: '大聲' },
                    { word: 'quiet', translation: '安靜' },
                    { word: 'heavy', translation: '重' },
                    { word: 'wrong', translation: '錯誤' },
                    { word: 'rich', translation: '富有' },
                    { word: 'poor', translation: '貧窮' },
                    { word: 'young', translation: '年輕' },
                    { word: 'smart', translation: '聰明' },
                    { word: 'kind', translation: '善良' },
                    { word: 'brave', translation: '勇敢' },
                    { word: 'nice', translation: '好的' },
                    { word: 'soft', translation: '軟的' },
                    { word: 'wet', translation: '濕的' },
                    { word: 'dry', translation: '乾的' },
                    { word: 'deep', translation: '深' },
                    { word: 'flat', translation: '平的' },
                    { word: 'sharp', translation: '尖的' },
                    { word: 'dull', translation: '鈍的' },
                    { word: 'rough', translation: '粗糙' },
                    { word: 'clear', translation: '清楚' },
                    { word: 'sunny', translation: '晴朗' },
                    { word: 'windy', translation: '有風' },
                    { word: 'rainy', translation: '下雨' },
                    { word: 'bell', translation: '鈴' },
                    { word: 'flag', translation: '旗' },
                    { word: 'key', translation: '鑰匙' },
                    { word: 'lock', translation: '鎖' },
                    { word: 'box', translation: '盒子' },
                    { word: 'bag', translation: '袋子' },
                    { word: 'ball', translation: '球' },
                    { word: 'toy', translation: '玩具' },
                    { word: 'pen', translation: '筆' },
                    { word: 'map', translation: '地圖' },
                    { word: 'cup', translation: '杯子' },
                    { word: 'bowl', translation: '碗' },
                    { word: 'dish', translation: '盤子' },
                    { word: 'fork', translation: '叉子' },
                    { word: 'spoon', translation: '湯匙' },
                    { word: 'knife', translation: '刀' },
                    { word: 'glass', translation: '玻璃' },
                    { word: 'plate', translation: '盤子' },
                    { word: 'salt', translation: '鹽' },
                    { word: 'sugar', translation: '糖' },
                    { word: 'oil', translation: '油' },
                    { word: 'soup', translation: '湯' },
                    { word: 'cake', translation: '蛋糕' },

                    // Medium words (6-8 letters) - 250 words
                    { word: 'computer', translation: '電腦' },
                    { word: 'keyboard', translation: '鍵盤' },
                    { word: 'monitor', translation: '螢幕' },
                    { word: 'speaker', translation: '揚聲器' },
                    { word: 'printer', translation: '印表機' },
                    { word: 'network', translation: '網路' },
                    { word: 'internet', translation: '網際網路' },
                    { word: 'website', translation: '網站' },
                    { word: 'download', translation: '下載' },
                    { word: 'upload', translation: '上傳' },
                    { word: 'software', translation: '軟體' },
                    { word: 'hardware', translation: '硬體' },
                    { word: 'program', translation: '程式' },
                    { word: 'function', translation: '功能' },
                    { word: 'variable', translation: '變數' },
                    { word: 'database', translation: '資料庫' },
                    { word: 'graphics', translation: '圖形' },
                    { word: 'digital', translation: '數位' },
                    { word: 'virtual', translation: '虛擬' },
                    { word: 'machine', translation: '機器' },
                    { word: 'science', translation: '科學' },
                    { word: 'technology', translation: '技術' },
                    { word: 'advanced', translation: '先進' },
                    { word: 'modern', translation: '現代' },
                    { word: 'animal', translation: '動物' },
                    { word: 'flower', translation: '花' },
                    { word: 'garden', translation: '花園' },
                    { word: 'forest', translation: '森林' },
                    { word: 'mountain', translation: '山' },
                    { word: 'river', translation: '河' },
                    { word: 'ocean', translation: '海洋' },
                    { word: 'beach', translation: '海灘' },
                    { word: 'island', translation: '島' },
                    { word: 'bridge', translation: '橋' },
                    { word: 'building', translation: '建築' },
                    { word: 'school', translation: '學校' },
                    { word: 'hospital', translation: '醫院' },
                    { word: 'library', translation: '圖書館' },
                    { word: 'museum', translation: '博物館' },
                    { word: 'church', translation: '教堂' },
                    { word: 'temple', translation: '寺廟' },
                    { word: 'office', translation: '辦公室' },
                    { word: 'station', translation: '車站' },
                    { word: 'airport', translation: '機場' },
                    { word: 'market', translation: '市場' },
                    { word: 'store', translation: '商店' },
                    { word: 'factory', translation: '工廠' },
                    { word: 'kitchen', translation: '廚房' },
                    { word: 'bedroom', translation: '臥室' },
                    { word: 'bathroom', translation: '浴室' },
                    { word: 'window', translation: '窗戶' },
                    { word: 'picture', translation: '圖片' },
                    { word: 'mirror', translation: '鏡子' },
                    { word: 'carpet', translation: '地毯' },
                    { word: 'curtain', translation: '窗簾' },
                    { word: 'blanket', translation: '毯子' },
                    { word: 'pillow', translation: '枕頭' },
                    { word: 'towel', translation: '毛巾' },
                    { word: 'basket', translation: '籃子' },
                    { word: 'bottle', translation: '瓶子' },
                    { word: 'bucket', translation: '水桶' },
                    { word: 'button', translation: '按鈕' },
                    { word: 'camera', translation: '相機' },
                    { word: 'candle', translation: '蠟燭' },
                    { word: 'corner', translation: '角落' },
                    { word: 'cotton', translation: '棉花' },
                    { word: 'doctor', translation: '醫生' },
                    { word: 'driver', translation: '司機' },
                    { word: 'farmer', translation: '農夫' },
                    { word: 'lawyer', translation: '律師' },
                    { word: 'nurse', translation: '護士' },
                    { word: 'police', translation: '警察' },
                    { word: 'soldier', translation: '士兵' },
                    { word: 'teacher', translation: '老師' },
                    { word: 'worker', translation: '工人' },
                    { word: 'writer', translation: '作家' },
                    { word: 'artist', translation: '藝術家' },
                    { word: 'singer', translation: '歌手' },
                    { word: 'dancer', translation: '舞者' },
                    { word: 'player', translation: '選手' },
                    { word: 'actor', translation: '演員' },
                    { word: 'director', translation: '導演' },
                    { word: 'manager', translation: '經理' },
                    { word: 'engineer', translation: '工程師' },
                    { word: 'designer', translation: '設計師' },
                    { word: 'painter', translation: '畫家' },
                    { word: 'scientist', translation: '科學家' },
                    { word: 'student', translation: '學生' },
                    { word: 'brother', translation: '兄弟' },
                    { word: 'sister', translation: '姐妹' },
                    { word: 'father', translation: '父親' },
                    { word: 'mother', translation: '母親' },
                    { word: 'parent', translation: '父母' },
                    { word: 'family', translation: '家庭' },
                    { word: 'friend', translation: '朋友' },
                    { word: 'neighbor', translation: '鄰居' },
                    { word: 'stranger', translation: '陌生人' },
                    { word: 'visitor', translation: '訪客' },
                    { word: 'guest', translation: '客人' },
                    { word: 'leader', translation: '領袖' },
                    { word: 'member', translation: '成員' },
                    { word: 'partner', translation: '夥伴' },
                    { word: 'person', translation: '人' },
                    { word: 'people', translation: '人們' },
                    { word: 'morning', translation: '早上' },
                    { word: 'evening', translation: '晚上' },
                    { word: 'night', translation: '夜晚' },
                    { word: 'noon', translation: '中午' },
                    { word: 'minute', translation: '分鐘' },
                    { word: 'second', translation: '秒' },
                    { word: 'moment', translation: '片刻' },
                    { word: 'period', translation: '期間' },
                    { word: 'season', translation: '季節' },
                    { word: 'spring', translation: '春天' },
                    { word: 'summer', translation: '夏天' },
                    { word: 'autumn', translation: '秋天' },
                    { word: 'winter', translation: '冬天' },
                    { word: 'weather', translation: '天氣' },
                    { word: 'climate', translation: '氣候' },
                    { word: 'storm', translation: '暴風雨' },
                    { word: 'thunder', translation: '雷' },
                    { word: 'rainbow', translation: '彩虹' },
                    { word: 'sunshine', translation: '陽光' },
                    { word: 'shadow', translation: '影子' },
                    { word: 'chicken', translation: '雞' },
                    { word: 'duck', translation: '鴨' },
                    { word: 'horse', translation: '馬' },
                    { word: 'sheep', translation: '羊' },
                    { word: 'rabbit', translation: '兔子' },
                    { word: 'mouse', translation: '老鼠' },
                    { word: 'monkey', translation: '猴子' },
                    { word: 'elephant', translation: '大象' },
                    { word: 'lion', translation: '獅子' },
                    { word: 'tiger', translation: '老虎' },
                    { word: 'bear', translation: '熊' },
                    { word: 'wolf', translation: '狼' },
                    { word: 'snake', translation: '蛇' },
                    { word: 'turtle', translation: '烏龜' },
                    { word: 'insect', translation: '昆蟲' },
                    { word: 'spider', translation: '蜘蛛' },
                    { word: 'branch', translation: '樹枝' },
                    { word: 'grass', translation: '草' },
                    { word: 'leaf', translation: '葉子' },
                    { word: 'seed', translation: '種子' },
                    { word: 'plant', translation: '植物' },
                    { word: 'orange', translation: '橙子' },
                    { word: 'banana', translation: '香蕉' },
                    { word: 'cherry', translation: '櫻桃' },
                    { word: 'melon', translation: '瓜' },
                    { word: 'potato', translation: '馬鈴薯' },
                    { word: 'tomato', translation: '番茄' },
                    { word: 'carrot', translation: '紅蘿蔔' },
                    { word: 'onion', translation: '洋蔥' },
                    { word: 'pepper', translation: '辣椒' },
                    { word: 'cheese', translation: '起司' },
                    { word: 'butter', translation: '奶油' },
                    { word: 'cream', translation: '奶油' },
                    { word: 'yogurt', translation: '優格' },
                    { word: 'honey', translation: '蜂蜜' },
                    { word: 'candy', translation: '糖果' },
                    { word: 'cookie', translation: '餅乾' },
                    { word: 'pizza', translation: '披薩' },
                    { word: 'burger', translation: '漢堡' },
                    { word: 'salad', translation: '沙拉' },
                    { word: 'sauce', translation: '醬汁' },
                    { word: 'dinner', translation: '晚餐' },
                    { word: 'lunch', translation: '午餐' },
                    { word: 'breakfast', translation: '早餐' },
                    { word: 'meal', translation: '餐' },
                    { word: 'snack', translation: '點心' },
                    { word: 'coffee', translation: '咖啡' },
                    { word: 'juice', translation: '果汁' },
                    { word: 'water', translation: '水' },
                    { word: 'bottle', translation: '瓶子' },
                    { word: 'clothes', translation: '衣服' },
                    { word: 'shirt', translation: '襯衫' },
                    { word: 'pants', translation: '褲子' },
                    { word: 'dress', translation: '洋裝' },
                    { word: 'skirt', translation: '裙子' },
                    { word: 'coat', translation: '外套' },
                    { word: 'jacket', translation: '夾克' },
                    { word: 'sweater', translation: '毛衣' },
                    { word: 'shoes', translation: '鞋子' },
                    { word: 'boots', translation: '靴子' },
                    { word: 'socks', translation: '襪子' },
                    { word: 'gloves', translation: '手套' },
                    { word: 'scarf', translation: '圍巾' },
                    { word: 'pocket', translation: '口袋' },
                    { word: 'zipper', translation: '拉鍊' },
                    { word: 'belt', translation: '皮帶' },
                    { word: 'ring', translation: '戒指' },
                    { word: 'watch', translation: '手錶' },
                    { word: 'necklace', translation: '項鍊' },
                    { word: 'glasses', translation: '眼鏡' },
                    { word: 'umbrella', translation: '雨傘' },
                    { word: 'wallet', translation: '錢包' },
                    { word: 'purse', translation: '錢包' },
                    { word: 'pocket', translation: '口袋' },
                    { word: 'paper', translation: '紙' },
                    { word: 'pencil', translation: '鉛筆' },
                    { word: 'eraser', translation: '橡皮擦' },
                    { word: 'ruler', translation: '尺' },
                    { word: 'scissors', translation: '剪刀' },
                    { word: 'glue', translation: '膠水' },
                    { word: 'tape', translation: '膠帶' },
                    { word: 'chalk', translation: '粉筆' },
                    { word: 'marker', translation: '麥克筆' },
                    { word: 'crayon', translation: '蠟筆' },
                    { word: 'brush', translation: '刷子' },
                    { word: 'color', translation: '顏色' },
                    { word: 'shape', translation: '形狀' },
                    { word: 'circle', translation: '圓形' },
                    { word: 'square', translation: '正方形' },
                    { word: 'triangle', translation: '三角形' },
                    { word: 'line', translation: '線' },
                    { word: 'point', translation: '點' },
                    { word: 'angle', translation: '角度' },
                    { word: 'center', translation: '中心' },
                    { word: 'edge', translation: '邊緣' },
                    { word: 'corner', translation: '角落' },
                    { word: 'surface', translation: '表面' },
                    { word: 'inside', translation: '內部' },
                    { word: 'outside', translation: '外部' },
                    { word: 'middle', translation: '中間' },
                    { word: 'between', translation: '之間' },
                    { word: 'across', translation: '穿過' },
                    { word: 'through', translation: '通過' },
                    { word: 'around', translation: '周圍' },
                    { word: 'behind', translation: '後面' },
                    { word: 'beside', translation: '旁邊' },
                    { word: 'under', translation: '下面' },
                    { word: 'above', translation: '上面' },
                    { word: 'below', translation: '下面' },
                    { word: 'over', translation: '上方' },

                    // Hard words (9+ letters) - 200 words
                    { word: 'programming', translation: '程式設計' },
                    { word: 'development', translation: '開發' },
                    { word: 'algorithm', translation: '演算法' },
                    { word: 'structure', translation: '結構' },
                    { word: 'framework', translation: '框架' },
                    { word: 'architecture', translation: '架構' },
                    { word: 'optimization', translation: '最佳化' },
                    { word: 'performance', translation: '效能' },
                    { word: 'intelligence', translation: '智慧' },
                    { word: 'automation', translation: '自動化' },
                    { word: 'integration', translation: '整合' },
                    { word: 'implementation', translation: '實作' },
                    { word: 'communication', translation: '溝通' },
                    { word: 'authentication', translation: '驗證' },
                    { word: 'configuration', translation: '設定' },
                    { word: 'documentation', translation: '文件' },
                    { word: 'specification', translation: '規格' },
                    { word: 'application', translation: '應用程式' },
                    { word: 'organization', translation: '組織' },
                    { word: 'information', translation: '資訊' },
                    { word: 'environment', translation: '環境' },
                    { word: 'education', translation: '教育' },
                    { word: 'transportation', translation: '運輸' },
                    { word: 'generation', translation: '世代' },
                    { word: 'population', translation: '人口' },
                    { word: 'government', translation: '政府' },
                    { word: 'management', translation: '管理' },
                    { word: 'relationship', translation: '關係' },
                    { word: 'situation', translation: '情況' },
                    { word: 'temperature', translation: '溫度' },
                    { word: 'difference', translation: '差異' },
                    { word: 'important', translation: '重要' },
                    { word: 'difficult', translation: '困難' },
                    { word: 'beautiful', translation: '美麗' },
                    { word: 'wonderful', translation: '美妙' },
                    { word: 'excellent', translation: '優秀' },
                    { word: 'dangerous', translation: '危險' },
                    { word: 'necessary', translation: '必要' },
                    { word: 'possible', translation: '可能' },
                    { word: 'impossible', translation: '不可能' },
                    { word: 'available', translation: '可用' },
                    { word: 'comfortable', translation: '舒適' },
                    { word: 'reasonable', translation: '合理' },
                    { word: 'responsible', translation: '負責' },
                    { word: 'successful', translation: '成功' },
                    { word: 'powerful', translation: '強大' },
                    { word: 'peaceful', translation: '和平' },
                    { word: 'careful', translation: '小心' },
                    { word: 'useful', translation: '有用' },
                    { word: 'helpful', translation: '有幫助' },
                    { word: 'colorful', translation: '多彩' },
                    { word: 'cheerful', translation: '快樂' },
                    { word: 'wonderful', translation: '精彩' },
                    { word: 'meaningful', translation: '有意義' },
                    { word: 'traditional', translation: '傳統' },
                    { word: 'international', translation: '國際' },
                    { word: 'professional', translation: '專業' },
                    { word: 'national', translation: '國家' },
                    { word: 'personal', translation: '個人' },
                    { word: 'natural', translation: '自然' },
                    { word: 'cultural', translation: '文化' },
                    { word: 'physical', translation: '身體' },
                    { word: 'chemical', translation: '化學' },
                    { word: 'medical', translation: '醫療' },
                    { word: 'electrical', translation: '電氣' },
                    { word: 'mechanical', translation: '機械' },
                    { word: 'historical', translation: '歷史' },
                    { word: 'practical', translation: '實用' },
                    { word: 'typical', translation: '典型' },
                    { word: 'critical', translation: '關鍵' },
                    { word: 'original', translation: '原始' },
                    { word: 'official', translation: '官方' },
                    { word: 'familiar', translation: '熟悉' },
                    { word: 'particular', translation: '特別' },
                    { word: 'regular', translation: '常規' },
                    { word: 'popular', translation: '流行' },
                    { word: 'similar', translation: '相似' },
                    { word: 'different', translation: '不同' },
                    { word: 'significant', translation: '重要' },
                    { word: 'independent', translation: '獨立' },
                    { word: 'confident', translation: '自信' },
                    { word: 'efficient', translation: '有效率' },
                    { word: 'sufficient', translation: '充足' },
                    { word: 'excellent', translation: '卓越' },
                    { word: 'brilliant', translation: '聰明' },
                    { word: 'frequent', translation: '頻繁' },
                    { word: 'consistent', translation: '一致' },
                    { word: 'permanent', translation: '永久' },
                    { word: 'temporary', translation: '暫時' },
                    { word: 'ordinary', translation: '普通' },
                    { word: 'necessary', translation: '必需' },
                    { word: 'secretary', translation: '秘書' },
                    { word: 'dictionary', translation: '字典' },
                    { word: 'machinery', translation: '機器' },
                    { word: 'discovery', translation: '發現' },
                    { word: 'recovery', translation: '恢復' },
                    { word: 'delivery', translation: '交付' },
                    { word: 'gallery', translation: '畫廊' },
                    { word: 'category', translation: '類別' },
                    { word: 'strategy', translation: '策略' },
                    { word: 'energy', translation: '能量' },
                    { word: 'memory', translation: '記憶' },
                    { word: 'history', translation: '歷史' },
                    { word: 'mystery', translation: '神秘' },
                    { word: 'victory', translation: '勝利' },
                    { word: 'factory', translation: '工廠' },
                    { word: 'directory', translation: '目錄' },
                    { word: 'territory', translation: '領土' },
                    { word: 'laboratory', translation: '實驗室' },
                    { word: 'vocabulary', translation: '詞彙' },
                    { word: 'capacity', translation: '容量' },
                    { word: 'facility', translation: '設施' },
                    { word: 'ability', translation: '能力' },
                    { word: 'quality', translation: '品質' },
                    { word: 'quantity', translation: '數量' },
                    { word: 'community', translation: '社區' },
                    { word: 'opportunity', translation: '機會' },
                    { word: 'university', translation: '大學' },
                    { word: 'security', translation: '安全' },
                    { word: 'authority', translation: '權威' },
                    { word: 'majority', translation: '多數' },
                    { word: 'minority', translation: '少數' },
                    { word: 'priority', translation: '優先' },
                    { word: 'activity', translation: '活動' },
                    { word: 'difficulty', translation: '困難' },
                    { word: 'possibility', translation: '可能性' },
                    { word: 'responsibility', translation: '責任' },
                    { word: 'personality', translation: '個性' },
                    { word: 'nationality', translation: '國籍' },
                    { word: 'curiosity', translation: '好奇心' },
                    { word: 'electricity', translation: '電力' },
                    { word: 'simplicity', translation: '簡單' },
                    { word: 'complexity', translation: '複雜' },
                    { word: 'diversity', translation: '多樣性' },
                    { word: 'university', translation: '大學' },
                    { word: 'emergency', translation: '緊急' },
                    { word: 'frequency', translation: '頻率' },
                    { word: 'tendency', translation: '趨勢' },
                    { word: 'efficiency', translation: '效率' },
                    { word: 'pregnancy', translation: '懷孕' },
                    { word: 'currency', translation: '貨幣' },
                    { word: 'accuracy', translation: '準確' },
                    { word: 'democracy', translation: '民主' },
                    { word: 'diplomacy', translation: '外交' },
                    { word: 'pharmacy', translation: '藥房' },
                    { word: 'privacy', translation: '隱私' },
                    { word: 'literacy', translation: '識字' },
                    { word: 'warranty', translation: '保證' },
                    { word: 'ceremony', translation: '儀式' },
                    { word: 'harmony', translation: '和諧' },
                    { word: 'testimony', translation: '證詞' },
                    { word: 'matrimony', translation: '婚姻' },
                    { word: 'symphony', translation: '交響樂' },
                    { word: 'astronomy', translation: '天文學' },
                    { word: 'economy', translation: '經濟' },
                    { word: 'autonomy', translation: '自治' },
                    { word: 'anatomy', translation: '解剖學' },
                    { word: 'gastronomy', translation: '美食學' },
                    { word: 'philosophy', translation: '哲學' },
                    { word: 'psychology', translation: '心理學' },
                    { word: 'biology', translation: '生物學' },
                    { word: 'sociology', translation: '社會學' },
                    { word: 'technology', translation: '科技' },
                    { word: 'mythology', translation: '神話' },
                    { word: 'archaeology', translation: '考古學' },
                    { word: 'geography', translation: '地理' },
                    { word: 'photography', translation: '攝影' },
                    { word: 'biography', translation: '傳記' },
                    { word: 'bibliography', translation: '書目' },
                    { word: 'calligraphy', translation: '書法' },
                    { word: 'choreography', translation: '編舞' },
                    { word: 'typography', translation: '排版' },
                    { word: 'topography', translation: '地形' },
                    { word: 'oceanography', translation: '海洋學' },
                    { word: 'methodology', translation: '方法論' },
                    { word: 'terminology', translation: '術語' },
                    { word: 'chronology', translation: '年表' },
                    { word: 'genealogy', translation: '家譜' },
                    { word: 'anthology', translation: '選集' },
                    { word: 'apology', translation: '道歉' },
                    { word: 'analogy', translation: '類比' },
                    { word: 'trilogy', translation: '三部曲' }
                ];

                this.zombieTypes = ['zombie1', 'zombie2', 'zombie3'];
                this.zombieImages = {
                    zombie1: 'images/Zombie1.png',
                    zombie2: 'images/Zombie2.png',
                    zombie3: 'images/Zombie3.png'
                };

                // Zombie stats: attack damage
                this.zombieStats = {
                    zombie1: { damage: 10, name: 'Walker' },
                    zombie2: { damage: 15, name: 'Swinger' },
                    zombie3: { damage: 20, name: 'Rusher' }
                };

                this.gameState = {
                    isPlaying: false,
                    isPaused: false,
                    score: 0,
                    hp: 100,
                    maxHp: 100,
                    level: 1,
                    wordsTyped: 0,
                    totalCharacters: 0,
                    correctCharacters: 0,
                    startTime: null,
                    fallingWords: [],
                    wordIdCounter: 0,
                    showTranslation: true,
                    gameMode: 'normal', // 'normal' or 'dictation'
                    healthItems: [],
                    musicEnabled: true
                };

                this.defaultWords = [...this.words]; // Store original words
                this.customWords = null; // Store custom uploaded words

                this.gameSpeed = 1;
                this.spawnRate = 4000; // milliseconds - slower initial spawn
                this.lastSpawnTime = 0;

                this.initializeElements();
                this.attachEventListeners();
            }

            initializeElements() {
                this.elements = {
                    gameArea: document.getElementById('gameArea'),
                    wordInput: document.getElementById('wordInput'),
                    currentTarget: document.getElementById('currentTarget'),

                    // Stats
                    score: document.getElementById('score'),
                    wpm: document.getElementById('wpm'),
                    accuracy: document.getElementById('accuracy'),
                    level: document.getElementById('level'),
                    hpBar: document.getElementById('hpBar'),
                    hpText: document.getElementById('hpText'),
                    wordSource: document.getElementById('wordSource'),

                    // Screens
                    startScreen: document.getElementById('startScreen'),
                    gameOverScreen: document.getElementById('gameOverScreen'),
                    pauseScreen: document.getElementById('pauseScreen'),

                    // Buttons
                    startBtn: document.getElementById('startBtn'),
                    restartBtn: document.getElementById('restartBtn'),
                    pauseBtn: document.getElementById('pauseBtn'),
                    resumeBtn: document.getElementById('resumeBtn'),
                    translationBtn: document.getElementById('translationBtn'),
                    musicBtn: document.getElementById('musicBtn'),
                    loadCsvBtn: document.getElementById('loadCsvBtn'),
                    clearCsvBtn: document.getElementById('clearCsvBtn'),

                    // Audio
                    bgMusic: document.getElementById('bgMusic'),
                    gunshotSound: document.getElementById('gunshotSound'),

                    // CSV elements
                    csvFileInput: document.getElementById('csvFileInput'),
                    csvStatus: document.getElementById('csvStatus'),

                    // Game mode elements
                    gameModeSection: document.getElementById('gameModeSection'),
                    normalModeBtn: document.getElementById('normalModeBtn'),
                    dictationModeBtn: document.getElementById('dictationModeBtn'),
                    gameMode: document.getElementById('gameMode'),

                    // Final stats
                    finalScore: document.getElementById('finalScore'),
                    finalWpm: document.getElementById('finalWpm'),
                    finalAccuracy: document.getElementById('finalAccuracy'),
                    finalLevel: document.getElementById('finalLevel')
                };
            }

            attachEventListeners() {
                this.elements.startBtn.addEventListener('click', () => this.startGame());
                this.elements.restartBtn.addEventListener('click', () => this.restartGame());
                this.elements.pauseBtn.addEventListener('click', () => this.togglePause());
                this.elements.resumeBtn.addEventListener('click', () => this.togglePause());
                this.elements.translationBtn.addEventListener('click', () => this.toggleTranslation());
                this.elements.musicBtn.addEventListener('click', () => this.toggleMusic());
                this.elements.loadCsvBtn.addEventListener('click', () => this.loadCustomWords());
                this.elements.clearCsvBtn.addEventListener('click', () => this.useDefaultWords());
                this.elements.normalModeBtn.addEventListener('click', () => this.setGameMode('normal'));
                this.elements.dictationModeBtn.addEventListener('click', () => this.setGameMode('dictation'));

                this.elements.wordInput.addEventListener('input', (e) => this.handleInput(e));
                this.elements.wordInput.addEventListener('keydown', (e) => this.handleKeydown(e));

                // Focus input when clicking on game area
                this.elements.gameArea.addEventListener('click', () => {
                    if (this.gameState.isPlaying && !this.gameState.isPaused) {
                        this.elements.wordInput.focus();
                    }
                });
            }

            startGame() {
                // Preserve translation setting and game mode
                const currentTranslationSetting = this.gameState.showTranslation;
                const currentGameMode = this.gameState.gameMode;
                const currentMusicEnabled = this.gameState.musicEnabled;

                this.gameState = {
                    isPlaying: true,
                    isPaused: false,
                    score: 0,
                    hp: 100,
                    maxHp: 100,
                    level: 1,
                    wordsTyped: 0,
                    totalCharacters: 0,
                    correctCharacters: 0,
                    startTime: Date.now(),
                    fallingWords: [],
                    wordIdCounter: 0,
                    showTranslation: currentTranslationSetting,
                    gameMode: currentGameMode,
                    healthItems: [],
                    musicEnabled: currentMusicEnabled
                };

                this.gameSpeed = 1;
                this.spawnRate = 4000;
                this.lastSpawnTime = 0;

                this.elements.startScreen.classList.add('hidden');
                this.elements.gameOverScreen.classList.add('hidden');
                this.elements.wordInput.focus();
                this.elements.wordInput.value = '';
                this.elements.currentTarget.textContent = 'Type the falling words!';

                // Clear any existing words
                this.elements.gameArea.innerHTML = '';

                // Start background music
                if (this.gameState.musicEnabled) {
                    this.playMusic();
                }

                this.updateStats();
                this.gameLoop();
            }

            playMusic() {
                this.elements.bgMusic.volume = 0.4; // Set volume to 40%
                this.elements.bgMusic.play().catch(err => {
                    console.log('Music autoplay failed:', err);
                    // Music will play when user interacts with the page
                });
            }

            stopMusic() {
                this.elements.bgMusic.pause();
                this.elements.bgMusic.currentTime = 0;
            }

            playGunshotSound() {
                // Reset the audio to start for rapid-fire typing
                this.elements.gunshotSound.currentTime = 0;
                this.elements.gunshotSound.play().catch(err => {
                    // Silently handle autoplay errors
                    console.log('Gunshot sound play failed:', err);
                });
            }

            toggleMusic() {
                this.gameState.musicEnabled = !this.gameState.musicEnabled;

                if (this.gameState.musicEnabled) {
                    this.elements.musicBtn.textContent = '🔊 MUSIC';
                    this.elements.musicBtn.className = 'px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors';
                    if (this.gameState.isPlaying && !this.gameState.isPaused) {
                        this.playMusic();
                    }
                } else {
                    this.elements.musicBtn.textContent = '🔇 MUSIC';
                    this.elements.musicBtn.className = 'px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors';
                    this.stopMusic();
                }
            }

            restartGame() {
                this.startGame();
            }

            togglePause() {
                this.gameState.isPaused = !this.gameState.isPaused;

                if (this.gameState.isPaused) {
                    this.elements.pauseScreen.classList.remove('hidden');
                    this.elements.pauseBtn.textContent = 'RESUME';
                    // Pause music
                    if (this.gameState.musicEnabled) {
                        this.elements.bgMusic.pause();
                    }
                } else {
                    this.elements.pauseScreen.classList.add('hidden');
                    this.elements.pauseBtn.textContent = 'PAUSE';
                    this.elements.wordInput.focus();
                    // Resume music
                    if (this.gameState.musicEnabled) {
                        this.elements.bgMusic.play().catch(err => console.log('Music resume failed:', err));
                    }
                }
            }

            gameLoop() {
                if (!this.gameState.isPlaying) return;

                if (!this.gameState.isPaused) {
                    this.updateFallingWords();
                    this.spawnWord();
                    this.checkCollisions();
                    this.updateStats();
                }

                requestAnimationFrame(() => this.gameLoop());
            }

            spawnWord() {
                const now = Date.now();
                if (now - this.lastSpawnTime > this.spawnRate / this.gameSpeed) {
                    const word = this.getRandomWord();
                    this.createFallingWord(word);
                    this.lastSpawnTime = now;
                }
            }

            toggleTranslation() {
                this.gameState.showTranslation = !this.gameState.showTranslation;

                // Update button text
                this.elements.translationBtn.textContent = this.gameState.showTranslation ? '中文 ON' : '中文 OFF';
                this.elements.translationBtn.className = this.gameState.showTranslation ?
                    'px-3 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors text-sm' :
                    'px-3 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors text-sm';

                // Update existing words
                this.gameState.fallingWords.forEach(wordObj => {
                    this.updateWordDisplay(wordObj);
                });
            }

            getRandomWord() {
                const level = this.gameState.level;
                let availableWords;

                // For custom words, use all words regardless of level to ensure all uploaded words appear
                if (this.customWords && this.customWords.length > 0) {
                    availableWords = this.words;
                } else {
                    // For default words, use level-based filtering
                    if (level <= 2) {
                        // Easy words only
                        availableWords = this.words.filter(wordData => wordData.word.length <= 5);
                    } else if (level <= 5) {
                        // Easy and medium words
                        availableWords = this.words.filter(wordData => wordData.word.length <= 8);
                    } else {
                        // All words
                        availableWords = this.words;
                    }
                }

                return availableWords[Math.floor(Math.random() * availableWords.length)];
            }

            createFallingWord(wordData) {
                const wordElement = document.createElement('div');
                const zombieType = this.zombieTypes[Math.floor(Math.random() * this.zombieTypes.length)];

                wordElement.className = `absolute zombie-word ${zombieType}`;
                wordElement.id = `word-${this.gameState.wordIdCounter++}`;

                this.elements.gameArea.appendChild(wordElement);

                const wordObj = {
                    element: wordElement,
                    word: wordData.word,
                    translation: wordData.translation,
                    id: wordElement.id,
                    zombieType: zombieType,
                    damage: this.zombieStats[zombieType].damage,
                    typedLetters: 0,
                    isActive: false,
                    isHit: false,
                    isAttacking: false,
                    lastAttackTime: 0
                };

                this.gameState.fallingWords.push(wordObj);

                // Set up display with zombie image and text overlay
                this.updateWordDisplay(wordObj);

                // Calculate zombie size based on viewport (10vw)
                const zombieWidth = window.innerWidth * 0.1;
                const zombieHeight = window.innerWidth * 0.175;

                // Find a non-overlapping position
                let x, y, attempts = 0;
                let positionFound = false;
                const maxAttempts = 50;

                while (!positionFound && attempts < maxAttempts) {
                    // Random position in a circle around center
                    const centerX = this.elements.gameArea.clientWidth / 2;
                    const centerY = this.elements.gameArea.clientHeight / 2;
                    const angle = Math.random() * 2 * Math.PI;
                    const radius = Math.min(this.elements.gameArea.clientWidth, this.elements.gameArea.clientHeight) * 0.3;

                    x = centerX + Math.cos(angle) * radius - zombieWidth / 2;
                    y = centerY + Math.sin(angle) * radius - zombieHeight / 2;

                    // Constrain to game area
                    x = Math.max(0, Math.min(x, this.elements.gameArea.clientWidth - zombieWidth));
                    y = Math.max(80, Math.min(y, this.elements.gameArea.clientHeight - zombieHeight - 100));

                    // Check for overlap with existing zombies
                    positionFound = true;
                    for (let existingWordObj of this.gameState.fallingWords) {
                        if (existingWordObj.id === wordObj.id) continue; // Skip self

                        const existingRect = existingWordObj.element.getBoundingClientRect();
                        const newRect = {
                            left: x,
                            top: y,
                            right: x + zombieWidth,
                            bottom: y + zombieHeight
                        };

                        // Check for overlap with padding (add 20px buffer)
                        const buffer = 20;
                        if (!(newRect.right + buffer < existingRect.left ||
                              newRect.left - buffer > existingRect.right ||
                              newRect.bottom + buffer < existingRect.top ||
                              newRect.top - buffer > existingRect.bottom)) {
                            positionFound = false;
                            break;
                        }
                    }

                    attempts++;
                }

                wordElement.style.left = x + 'px';
                wordElement.style.top = y + 'px';

                // Animation duration based on level and zombie type
                // Significantly slowed down for better gameplay
                let baseDuration = Math.max(8, (10 - this.gameState.level * 0.5) * 2);

                // Zombie3 is faster
                if (zombieType === 'zombie3') {
                    baseDuration *= 0.75;
                }
                // Zombie2 is medium speed
                else if (zombieType === 'zombie2') {
                    baseDuration *= 0.9;
                }

                wordElement.style.animationDuration = baseDuration + 's';

                // Add zombie idle animation when approaching is complete
                setTimeout(() => {
                    if (wordElement.parentNode) {
                        wordElement.classList.add('zombie-idle');
                    }
                }, baseDuration * 1000);
            }

            updateWordDisplay(wordObj) {
                const word = wordObj.word;
                const translation = wordObj.translation;
                const zombieImage = this.zombieImages[wordObj.zombieType];

                if (this.gameState.gameMode === 'dictation') {
                    // Dictation mode: Show Chinese translation, hide English letters initially
                    const letterSpans = word.split('').map((letter, index) =>
                        `<span class="letter" data-index="${index}">_</span>`
                    ).join(' ');

                    wordObj.element.innerHTML = `
                        <div class="zombie-container">
                            <img src="${zombieImage}" alt="Zombie" class="zombie-image">
                            <div class="zombie-text-overlay">
                                <div class="text-gray-400 font-mono tracking-wider" style="font-size: 1vw;">${letterSpans}</div>
                                <div class="font-bold text-blue-600 dark:text-blue-400" style="margin-top: 0.4vw; font-size: 1vw;">${translation}</div>
                            </div>
                        </div>
                    `;
                } else {
                    // Normal mode: Show English word with optional translation
                    const letterSpans = word.split('').map((letter, index) =>
                        `<span class="letter" data-index="${index}">${letter}</span>`
                    ).join('');

                    const translationHtml = this.gameState.showTranslation ?
                        `<div class="text-gray-600 dark:text-gray-400" style="margin-top: 0.3vw; font-size: 0.9vw;">(${translation})</div>` : '';

                    wordObj.element.innerHTML = `
                        <div class="zombie-container">
                            <img src="${zombieImage}" alt="Zombie" class="zombie-image">
                            <div class="zombie-text-overlay">
                                <div class="font-bold" style="font-size: 1.1vw;">${letterSpans}</div>
                                ${translationHtml}
                            </div>
                        </div>
                    `;
                }
            }

            updateFallingWords() {
                const now = Date.now();

                this.gameState.fallingWords = this.gameState.fallingWords.filter(wordObj => {
                    const element = wordObj.element;
                    const computedStyle = window.getComputedStyle(element);
                    const transform = computedStyle.transform;

                    // Check if animation has reached dangerous proximity (scale > 1.2 means very close)
                    if (transform && transform !== 'none') {
                        const matrix = new DOMMatrix(transform);
                        const scaleX = Math.sqrt(matrix.a * matrix.a + matrix.b * matrix.b);

                        if (scaleX >= 1.4) {
                            // Zombie reached the player
                            if (!wordObj.isAttacking) {
                                // First time reaching player - pause and attack
                                wordObj.isAttacking = true;
                                wordObj.lastAttackTime = now;
                                element.style.animationPlayState = 'paused';

                                // First attack
                                this.takeDamage(wordObj.damage);

                                // Add attacking visual effect
                                element.style.filter = 'brightness(1.3) drop-shadow(0 0 20px #ff0000)';
                            } else {
                                // Continue attacking every 2 seconds
                                if (now - wordObj.lastAttackTime >= 2000) {
                                    wordObj.lastAttackTime = now;
                                    this.takeDamage(wordObj.damage);

                                    // Attack flash effect
                                    element.style.filter = 'brightness(2) drop-shadow(0 0 30px #ff0000)';
                                    setTimeout(() => {
                                        if (element.parentNode) {
                                            element.style.filter = 'brightness(1.3) drop-shadow(0 0 20px #ff0000)';
                                        }
                                    }, 200);
                                }
                            }
                        }
                    }

                    return true;
                });
            }

            handleInput(e) {
                if (!this.gameState.isPlaying || this.gameState.isPaused) return;

                const input = e.target.value.toLowerCase();

                // Clear all visual states first
                this.gameState.fallingWords.forEach(wordObj => {
                    wordObj.isActive = false;
                    const letters = wordObj.element.querySelectorAll('.letter');
                    letters.forEach(letter => {
                        letter.classList.remove('typed', 'current');
                    });
                    // Remove highlight
                    const overlay = wordObj.element.querySelector('.zombie-text-overlay');
                    if (overlay) {
                        overlay.classList.remove('border-yellow-500', 'bg-yellow-50', 'dark:bg-yellow-900/20');
                    }
                });

                if (!input) {
                    this.elements.currentTarget.textContent = 'Type the approaching words!';
                    return;
                }

                // Find the best matching word (most letters typed correctly)
                let bestMatch = null;
                let maxCorrectLetters = 0;

                this.gameState.fallingWords.forEach(wordObj => {
                    const word = wordObj.word.toLowerCase();
                    let correctLetters = 0;

                    for (let i = 0; i < Math.min(input.length, word.length); i++) {
                        if (input[i] === word[i]) {
                            correctLetters++;
                        } else {
                            break;
                        }
                    }

                    if (correctLetters > maxCorrectLetters) {
                        maxCorrectLetters = correctLetters;
                        bestMatch = wordObj;
                    }
                });

                if (bestMatch && maxCorrectLetters > 0) {
                    bestMatch.isActive = true;

                    const letters = bestMatch.element.querySelectorAll('.letter');
                    const word = bestMatch.word.toLowerCase();

                    // Check if this is a new letter hit (zombie gets shot!)
                    if (maxCorrectLetters > bestMatch.typedLetters) {
                        this.triggerZombieHitEffect(bestMatch);
                        this.playGunshotSound(); // Play gunshot sound on each correct letter
                    }

                    bestMatch.typedLetters = maxCorrectLetters;

                    // In dictation mode, reveal typed letters
                    if (this.gameState.gameMode === 'dictation') {
                        for (let i = 0; i < word.length; i++) {
                            if (i < maxCorrectLetters) {
                                // Show correctly typed letters
                                letters[i].textContent = word[i];
                                letters[i].classList.add('typed');
                            } else if (i === maxCorrectLetters) {
                                // Show current letter to type
                                letters[i].textContent = '_';
                                letters[i].classList.add('current');
                            } else {
                                // Keep remaining letters hidden
                                letters[i].textContent = '_';
                            }
                        }
                    } else {
                        // Normal mode behavior
                        for (let i = 0; i < maxCorrectLetters; i++) {
                            letters[i].classList.add('typed');
                        }

                        if (maxCorrectLetters < word.length) {
                            letters[maxCorrectLetters].classList.add('current');
                        }
                    }

                    // Check if word is complete
                    if (input === word) {
                        this.destroyWord(bestMatch);
                        e.target.value = '';
                        return;
                    }

                    // Check if there's an incorrect letter
                    if (input.length > maxCorrectLetters) {
                        this.handleIncorrectLetter();
                        return;
                    }

                    this.elements.currentTarget.textContent = `Typing: ${bestMatch.word} (${maxCorrectLetters}/${word.length})`;

                    // Highlight the active word overlay
                    const overlay = bestMatch.element.querySelector('.zombie-text-overlay');
                    if (overlay) {
                        overlay.classList.add('border-yellow-500', 'bg-yellow-50', 'dark:bg-yellow-900/20');
                    }
                } else if (input.length > 0) {
                    this.handleIncorrectLetter();
                }
            }

            handleKeydown(e) {
                // Allow space in words, but handle Enter to clear input if needed
                if (e.key === 'Escape') {
                    e.preventDefault();
                    this.elements.wordInput.value = '';
                    this.elements.currentTarget.textContent = 'Input cleared!';
                }
            }

            triggerZombieHitEffect(wordObj) {
                // Prevent animation stacking
                if (wordObj.isHit) return;

                // Remove any existing hit effects
                wordObj.element.classList.remove('hit-stun', 'hit-knockback');

                // Randomly choose between stun and knockback (70% stun, 30% knockback)
                const hitType = Math.random() < 0.7 ? 'stun' : 'knockback';

                if (hitType === 'stun') {
                    wordObj.element.classList.add('hit-stun');
                    // Remove the class after animation completes
                    setTimeout(() => {
                        if (wordObj.element.parentNode) {
                            wordObj.element.classList.remove('hit-stun');
                        }
                    }, 300);
                } else {
                    // Knockback: pause the zombie's approach animation
                    const currentAnimation = wordObj.element.style.animation;
                    wordObj.element.style.animationPlayState = 'paused';

                    wordObj.element.classList.add('hit-knockback');

                    // After knockback animation completes, resume approach from new position
                    setTimeout(() => {
                        if (wordObj.element.parentNode) {
                            // Remove knockback class to allow approach animation to continue
                            wordObj.element.classList.remove('hit-knockback');
                            // Resume the approach animation
                            wordObj.element.style.animationPlayState = 'running';
                        }
                    }, 600);
                }

                // Mark as hit to prevent animation stacking
                wordObj.isHit = true;
                setTimeout(() => {
                    wordObj.isHit = false;
                }, 700);
            }

            destroyWord(wordObj) {
                // Get zombie position before death animation
                const rect = wordObj.element.getBoundingClientRect();
                const dropX = rect.left + rect.width / 2;
                const dropY = rect.top + rect.height / 2;

                // Zombie death animation
                wordObj.element.classList.add('zombie-death');

                setTimeout(() => {
                    wordObj.element.remove();
                }, 800);

                // Calculate score based on word length
                const points = wordObj.word.length * 10 * this.gameState.level;
                this.gameState.score += points;
                this.gameState.wordsTyped++;
                this.gameState.correctCharacters += wordObj.word.length;
                this.gameState.totalCharacters += wordObj.word.length;

                // 5% chance to drop health item
                if (Math.random() < 0.05) {
                    this.dropHealthItem(dropX, dropY);
                }

                // Remove from falling words array
                this.gameState.fallingWords = this.gameState.fallingWords.filter(w => w.id !== wordObj.id);

                // Check for level up
                if (this.gameState.wordsTyped % 10 === 0) {
                    this.levelUp();
                }

                this.elements.currentTarget.textContent = 'Zombie eliminated!';
                setTimeout(() => {
                    if (this.gameState.isPlaying) {
                        this.elements.currentTarget.textContent = 'Keep shooting!';
                    }
                }, 1000);
            }

            dropHealthItem(x, y) {
                const item = document.createElement('div');
                item.className = 'health-item';
                item.innerHTML = '<img src="images/Medicine.png" alt="Health Pack">';
                item.style.left = (x - 50) + 'px'; // Center the 100px item
                item.style.top = (y - 50) + 'px';

                const itemId = 'health-' + Date.now();
                item.id = itemId;

                this.elements.gameArea.appendChild(item);

                // Add to health items array
                this.gameState.healthItems.push({
                    id: itemId,
                    element: item,
                    x: x,
                    y: y
                });

                // Auto-collect after 1 second (给玩家看到掉落的时间)
                setTimeout(() => {
                    if (document.getElementById(itemId)) {
                        this.collectHealthItem(itemId);
                    }
                }, 1000);
            }

            collectHealthItem(itemId) {
                const item = this.gameState.healthItems.find(h => h.id === itemId);
                if (!item) return;

                const healAmount = 20;

                // Add collecting animation
                const element = item.element;
                element.classList.add('collecting');

                // Heal after a short delay for visual effect
                setTimeout(() => {
                    this.healHP(healAmount);
                }, 200);

                // Remove element after animation
                setTimeout(() => {
                    element.remove();
                }, 800);

                // Remove from array
                this.gameState.healthItems = this.gameState.healthItems.filter(h => h.id !== itemId);

                this.elements.currentTarget.textContent = '💚 +20 HP!';
                setTimeout(() => {
                    if (this.gameState.isPlaying) {
                        this.elements.currentTarget.textContent = 'Keep typing!';
                    }
                }, 1500);
            }

            handleIncorrectLetter() {
                const input = this.elements.wordInput;
                input.classList.add('shake');
                input.style.borderColor = '#ef4444';

                setTimeout(() => {
                    input.classList.remove('shake');
                    input.style.borderColor = '';
                    // Players must manually correct their mistakes (no auto-delete)
                }, 200);

                this.elements.currentTarget.textContent = 'Wrong letter! Press Backspace to correct!';
            }

            handleMiss() {
                const input = this.elements.wordInput;
                input.classList.add('shake');
                input.style.borderColor = '#ef4444';

                this.gameState.totalCharacters += input.value.length;

                setTimeout(() => {
                    input.classList.remove('shake');
                    input.style.borderColor = '';
                    input.value = '';
                }, 300);

                this.elements.currentTarget.textContent = 'Miss! Try again!';
            }

            takeDamage(damage) {
                this.gameState.hp = Math.max(0, this.gameState.hp - damage);
                this.updateHP(false); // false = damage

                if (this.gameState.hp <= 0) {
                    this.gameOver();
                }
            }

            healHP(amount) {
                this.gameState.hp = Math.min(this.gameState.maxHp, this.gameState.hp + amount);
                this.updateHP(true); // true = heal
            }

            updateHP(isHeal = false) {
                const hpPercentage = (this.gameState.hp / this.gameState.maxHp) * 100;
                this.elements.hpBar.style.width = hpPercentage + '%';
                this.elements.hpText.textContent = `${this.gameState.hp} / ${this.gameState.maxHp}`;

                // Update HP bar color based on health
                if (hpPercentage > 60) {
                    this.elements.hpBar.className = 'absolute top-0 left-0 h-full bg-gradient-to-r from-green-500 to-green-600 transition-all duration-300 ease-out';
                } else if (hpPercentage > 30) {
                    this.elements.hpBar.className = 'absolute top-0 left-0 h-full bg-gradient-to-r from-yellow-500 to-orange-500 transition-all duration-300 ease-out';
                } else {
                    this.elements.hpBar.className = 'absolute top-0 left-0 h-full bg-gradient-to-r from-red-500 to-red-600 transition-all duration-300 ease-out';
                }

                // Add animation effect
                if (isHeal) {
                    this.elements.hpBar.classList.add('hp-heal');
                    setTimeout(() => {
                        this.elements.hpBar.classList.remove('hp-heal');
                    }, 600);
                } else {
                    this.elements.hpBar.classList.add('hp-damage');
                    setTimeout(() => {
                        this.elements.hpBar.classList.remove('hp-damage');
                    }, 500);

                    // Screen flash on damage
                    document.body.style.background = '#fee2e2';
                    setTimeout(() => {
                        document.body.style.background = '';
                    }, 200);
                }
            }

            levelUp() {
                this.gameState.level++;

                // Gentler difficulty curve
                // gameSpeed increases slowly: 1.0 -> 1.5 (caps at level 11)
                this.gameSpeed = Math.min(1.5, 1 + (this.gameState.level - 1) * 0.05);

                // spawnRate decreases gradually: 4000ms -> 600ms (caps at level 23)
                this.spawnRate = Math.max(600, 4000 - (this.gameState.level - 1) * 150);

                // Visual feedback
                this.elements.currentTarget.textContent = `LEVEL UP! Level ${this.gameState.level}`;
                setTimeout(() => {
                    if (this.gameState.isPlaying) {
                        this.elements.currentTarget.textContent = 'Keep typing!';
                    }
                }, 2000);
            }

            checkCollisions() {
                // This function is no longer needed as zombies now stop and attack
                // Attack logic is handled in updateFallingWords()
            }

            updateStats() {
                this.elements.score.textContent = this.gameState.score.toLocaleString();
                this.elements.level.textContent = this.gameState.level;

                // Update HP bar
                const hpPercentage = (this.gameState.hp / this.gameState.maxHp) * 100;
                this.elements.hpBar.style.width = hpPercentage + '%';
                this.elements.hpText.textContent = `${this.gameState.hp} / ${this.gameState.maxHp}`;

                // Calculate WPM
                const timeElapsed = (Date.now() - this.gameState.startTime) / 60000; // minutes
                const wpm = timeElapsed > 0 ? Math.round(this.gameState.wordsTyped / timeElapsed) : 0;
                this.elements.wpm.textContent = wpm;

                // Calculate accuracy
                const accuracy = this.gameState.totalCharacters > 0 ?
                    Math.round((this.gameState.correctCharacters / this.gameState.totalCharacters) * 100) : 100;
                this.elements.accuracy.textContent = accuracy + '%';
            }

            loadCustomWords() {
                const fileInput = this.elements.csvFileInput;
                if (!fileInput.files || !fileInput.files[0]) {
                    this.showCsvStatus('Please select a CSV file first.', 'error');
                    return;
                }

                const file = fileInput.files[0];
                const reader = new FileReader();

                reader.onload = (e) => {
                    try {
                        const csvText = e.target.result;
                        console.log('CSV Text:', csvText); // Debug
                        const customWords = this.parseCSV(csvText);
                        console.log('Parsed words:', customWords); // Debug

                        if (customWords.length === 0) {
                            this.showCsvStatus('No valid words found in CSV file. Please check format: word,translation', 'error');
                            return;
                        }

                        this.customWords = customWords;
                        this.words = customWords;

                        this.showCsvStatus(`Successfully loaded ${customWords.length} words from CSV.`, 'success');
                        this.elements.wordSource.textContent = 'CUSTOM';
                        this.elements.wordSource.className = 'text-sm font-bold text-blue-500';

                        // Show game mode selection when custom words are loaded
                        this.elements.gameModeSection.classList.remove('hidden');

                    } catch (error) {
                        console.error('CSV parsing error:', error);
                        this.showCsvStatus('Error reading CSV file: ' + error.message, 'error');
                    }
                };

                reader.onerror = () => {
                    this.showCsvStatus('Error reading file.', 'error');
                };

                // Specify UTF-8 encoding to handle Chinese characters
                reader.readAsText(file, 'UTF-8');
            }

            parseCSV(csvText) {
                const lines = csvText.split('\n').filter(line => line.trim());
                const words = [];

                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;

                    // Split by comma and handle quoted values
                    const parts = this.splitCSVLine(line);

                    if (parts.length >= 1) {
                        const word = parts[0].trim();
                        const translation = parts.length > 1 ? parts[1].trim() : word;

                        // Validate word (only letters and basic punctuation)
                        if (word && /^[a-zA-Z\s\-']+$/.test(word)) {
                            words.push({
                                word: word.toLowerCase(),
                                translation: translation || word
                            });
                        }
                    }
                }

                return words;
            }

            splitCSVLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;

                for (let i = 0; i < line.length; i++) {
                    const char = line[i];

                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current);
                        current = '';
                    } else {
                        current += char;
                    }
                }

                result.push(current);
                return result;
            }

            useDefaultWords() {
                this.customWords = null;
                this.words = [...this.defaultWords];

                this.showCsvStatus('Using default word list.', 'success');
                this.elements.wordSource.textContent = 'DEFAULT';
                this.elements.wordSource.className = 'text-sm font-bold text-orange-500';

                // Hide game mode selection when using default words
                this.elements.gameModeSection.classList.add('hidden');
                this.setGameMode('normal');

                // Clear file input
                this.elements.csvFileInput.value = '';
            }

            setGameMode(mode) {
                this.gameState.gameMode = mode;

                // Update UI
                if (mode === 'normal') {
                    this.elements.gameMode.textContent = 'NORMAL';
                    this.elements.gameMode.className = 'text-sm font-bold text-purple-500';
                    this.elements.normalModeBtn.className = 'px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors text-sm';
                    this.elements.dictationModeBtn.className = 'px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500 transition-colors text-sm';

                    // Show translation button in normal mode
                    this.elements.translationBtn.style.display = 'block';
                } else if (mode === 'dictation') {
                    this.elements.gameMode.textContent = 'DICTATION';
                    this.elements.gameMode.className = 'text-sm font-bold text-pink-500';
                    this.elements.dictationModeBtn.className = 'px-4 py-2 bg-pink-500 text-white rounded hover:bg-pink-600 transition-colors text-sm';
                    this.elements.normalModeBtn.className = 'px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500 transition-colors text-sm';

                    // Hide translation button in dictation mode (always show Chinese)
                    this.elements.translationBtn.style.display = 'none';
                }

                // Update existing words if in game
                if (this.gameState.isPlaying) {
                    this.gameState.fallingWords.forEach(wordObj => {
                        this.updateWordDisplay(wordObj);
                    });
                }
            }

            showCsvStatus(message, type) {
                const statusElement = this.elements.csvStatus;
                statusElement.textContent = message;

                if (type === 'success') {
                    statusElement.className = 'text-sm text-green-600 dark:text-green-400';
                } else if (type === 'error') {
                    statusElement.className = 'text-sm text-red-600 dark:text-red-400';
                } else {
                    statusElement.className = 'text-sm text-gray-600 dark:text-gray-400';
                }

                // Clear status after 3 seconds
                setTimeout(() => {
                    statusElement.textContent = '';
                }, 3000);
            }

            gameOver() {
                this.gameState.isPlaying = false;

                // Stop music
                this.stopMusic();

                // Clear all falling words
                this.gameState.fallingWords.forEach(wordObj => wordObj.element.remove());
                this.gameState.fallingWords = [];

                // Show final stats
                const timeElapsed = (Date.now() - this.gameState.startTime) / 60000;
                const finalWpm = timeElapsed > 0 ? Math.round(this.gameState.wordsTyped / timeElapsed) : 0;
                const finalAccuracy = this.gameState.totalCharacters > 0 ?
                    Math.round((this.gameState.correctCharacters / this.gameState.totalCharacters) * 100) : 100;

                this.elements.finalScore.textContent = this.gameState.score.toLocaleString();
                this.elements.finalWpm.textContent = finalWpm;
                this.elements.finalAccuracy.textContent = finalAccuracy + '%';
                this.elements.finalLevel.textContent = this.gameState.level;

                this.elements.gameOverScreen.classList.remove('hidden');
            }
        }

        // Start the game when page loads
        window.addEventListener('load', () => {
            new TypingGame();
        });
    </script>
</body>
</html>

