<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Defense - English Typing Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes zombieApproach {
            0% {
                transform: translateZ(-1000px) scale(0.1) translateX(0px) rotate(0deg);
                opacity: 0.3;
            }
            10% {
                transform: translateZ(-800px) scale(0.2) translateX(-10px) rotate(-2deg);
                opacity: 0.4;
            }
            20% {
                transform: translateZ(-600px) scale(0.35) translateX(8px) rotate(1deg);
                opacity: 0.5;
            }
            30% {
                transform: translateZ(-400px) scale(0.5) translateX(-15px) rotate(-1.5deg);
                opacity: 0.6;
            }
            40% {
                transform: translateZ(-200px) scale(0.7) translateX(12px) rotate(2deg);
                opacity: 0.75;
            }
            50% {
                transform: translateZ(-100px) scale(0.85) translateX(-8px) rotate(-0.5deg);
                opacity: 0.85;
            }
            60% {
                transform: translateZ(-50px) scale(1.0) translateX(5px) rotate(1deg);
                opacity: 0.9;
            }
            70% {
                transform: translateZ(-25px) scale(1.1) translateX(-7px) rotate(-1deg);
                opacity: 0.95;
            }
            80% {
                transform: translateZ(-10px) scale(1.25) translateX(3px) rotate(0.5deg);
                opacity: 0.98;
            }
            90% {
                transform: translateZ(-5px) scale(1.35) translateX(-2px) rotate(-0.5deg);
                opacity: 1;
            }
            100% {
                transform: translateZ(0) scale(1.5) translateX(0px) rotate(0deg);
                opacity: 1;
            }
        }

        /* Zombie 1 - ç›´çº¿å‰è¿›ï¼Œè½»å¾®æ‘‡æ‘† */
        @keyframes zombie1Approach {
            0% {
                transform: translateZ(-1000px) scale(0.8) translateX(0px) rotate(0deg);
                opacity: 0.3;
            }
            100% {
                transform: translateZ(0) scale(1.5) translateX(0px) rotate(0deg);
                opacity: 1;
            }
        }

        /* Zombie 2 - å·¦å³æ‘‡æ‘†å‰è¿› */
        @keyframes zombie2Approach {
            0% {
                transform: translateZ(-1000px) scale(0.8) translateX(-30px) rotate(-5deg);
                opacity: 0.3;
            }
            25% {
                transform: translateZ(-750px) scale(0.95) translateX(30px) rotate(5deg);
                opacity: 0.5;
            }
            50% {
                transform: translateZ(-500px) scale(1.1) translateX(-30px) rotate(-5deg);
                opacity: 0.7;
            }
            75% {
                transform: translateZ(-250px) scale(1.3) translateX(30px) rotate(5deg);
                opacity: 0.9;
            }
            100% {
                transform: translateZ(0) scale(1.5) translateX(0px) rotate(0deg);
                opacity: 1;
            }
        }

        /* Zombie 3 - å¿«é€Ÿå†²åˆºï¼ŒæŠ–åŠ¨å‰è¿› */
        @keyframes zombie3Approach {
            0% {
                transform: translateZ(-1000px) scale(0.8) translateX(0px) rotate(0deg);
                opacity: 0.3;
            }
            10% {
                transform: translateZ(-700px) scale(0.9) translateX(-5px) rotate(-2deg);
                opacity: 0.5;
            }
            20% {
                transform: translateZ(-500px) scale(1.0) translateX(5px) rotate(2deg);
                opacity: 0.65;
            }
            30% {
                transform: translateZ(-350px) scale(1.1) translateX(-5px) rotate(-2deg);
                opacity: 0.8;
            }
            50% {
                transform: translateZ(-150px) scale(1.3) translateX(5px) rotate(2deg);
                opacity: 0.9;
            }
            70% {
                transform: translateZ(-50px) scale(1.4) translateX(-3px) rotate(-1deg);
                opacity: 0.95;
            }
            100% {
                transform: translateZ(0) scale(1.5) translateX(0px) rotate(0deg);
                opacity: 1;
            }
        }

        .zombie-word {
            perspective: 1000px;
            transform-style: preserve-3d;
            filter: drop-shadow(2px 2px 8px rgba(0,0,0,0.8));
        }

        .zombie-word.zombie1 {
            animation: zombie1Approach linear;
        }

        .zombie-word.zombie2 {
            animation: zombie2Approach linear;
        }

        .zombie-word.zombie3 {
            animation: zombie3Approach linear;
        }

        @keyframes zombieStagger {
            0% { transform: translateX(0px) rotate(0deg); }
            25% { transform: translateX(-3px) rotate(-1deg); }
            50% { transform: translateX(2px) rotate(1deg); }
            75% { transform: translateX(-1px) rotate(-0.5deg); }
            100% { transform: translateX(0px) rotate(0deg); }
        }

        .zombie-idle {
            animation: zombieStagger 2s ease-in-out infinite;
        }

        @keyframes hitStun {
            0% {
                transform: translateZ(0px) scale(1);
                filter: brightness(1) hue-rotate(0deg) drop-shadow(2px 2px 8px rgba(0,0,0,0.8));
            }
            50% {
                transform: translateZ(0px) scale(1);
                filter: brightness(1.8) hue-rotate(0deg) drop-shadow(0 0 15px #ffff00);
            }
            100% {
                transform: translateZ(0px) scale(1);
                filter: brightness(1) hue-rotate(0deg) drop-shadow(2px 2px 8px rgba(0,0,0,0.8));
            }
        }

        @keyframes hitKnockback {
            0% {
                transform: translateZ(0px) scale(1) rotate(0deg);
                filter: brightness(1) drop-shadow(2px 2px 8px rgba(0,0,0,0.8));
                animation-play-state: running;
            }
            50% {
                transform: translateZ(-120px) scale(0.8) rotate(-3deg);
                filter: brightness(1.8) drop-shadow(0 0 15px #ff4444);
                animation-play-state: running;
            }
            100% {
                transform: translateZ(-120px) scale(0.8) rotate(0deg);
                filter: brightness(1) drop-shadow(2px 2px 8px rgba(0,0,0,0.8));
                animation-play-state: paused;
            }
        }

        .hit-stun {
            animation: hitStun 0.3s ease-out !important;
            animation-fill-mode: forwards !important;
        }

        .hit-knockback {
            animation: hitKnockback 0.6s ease-out !important;
            animation-fill-mode: forwards !important;
        }

        @keyframes zombieDeath {
            0% {
                transform: scale(1) rotate(0deg);
                filter: brightness(1) drop-shadow(2px 2px 8px rgba(0,0,0,0.8));
                opacity: 1;
            }
            25% {
                transform: scale(1.1) rotate(-5deg);
                filter: brightness(2) hue-rotate(0deg) drop-shadow(0 0 20px #ff0000);
                opacity: 1;
            }
            50% {
                transform: scale(0.9) rotate(5deg);
                filter: brightness(1.5) hue-rotate(30deg) drop-shadow(0 0 15px #ff0000);
                opacity: 0.8;
            }
            75% {
                transform: scale(0.7) rotate(-10deg);
                filter: brightness(0.5) hue-rotate(60deg) drop-shadow(0 0 10px #ff0000);
                opacity: 0.4;
            }
            100% {
                transform: scale(0.3) rotate(15deg);
                filter: brightness(0) grayscale(1);
                opacity: 0;
            }
        }

        .zombie-death {
            animation: zombieDeath 0.8s ease-out forwards !important;
        }

        .letter {
            display: inline-block;
            transition: all 0.2s ease;
        }

        .letter.typed {
            background: #10b981;
            color: white;
            border-radius: 4px;
            padding: 0 2px;
        }

        .letter.current {
            background: #f59e0b;
            color: white;
            border-radius: 4px;
            padding: 0 2px;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .shake {
            animation: shake 0.3s ease-in-out;
        }

        @keyframes pulse-success {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .pulse-success {
            animation: pulse-success 0.3s ease-in-out;
        }

        @keyframes hpDamage {
            0% {
                filter: brightness(1);
                transform: scale(1);
            }
            25% {
                filter: brightness(2) drop-shadow(0 0 10px #ff0000);
                transform: scale(1.1);
            }
            50% {
                filter: brightness(0.5);
                transform: scale(0.95);
            }
            100% {
                filter: brightness(1);
                transform: scale(1);
            }
        }

        @keyframes hpHeal {
            0% {
                filter: brightness(1);
                transform: scale(1);
            }
            50% {
                filter: brightness(2) drop-shadow(0 0 15px #00ff00);
                transform: scale(1.15);
            }
            100% {
                filter: brightness(1);
                transform: scale(1);
            }
        }

        .hp-damage {
            animation: hpDamage 0.5s ease-out;
        }

        .hp-heal {
            animation: hpHeal 0.6s ease-out;
        }

        @keyframes itemDrop {
            0% {
                opacity: 0;
                transform: translateY(-50px) scale(0.5) rotate(0deg);
            }
            60% {
                opacity: 1;
                transform: translateY(0px) scale(1.2) rotate(180deg);
            }
            80% {
                transform: scale(0.9) rotate(360deg);
            }
            100% {
                transform: scale(1) rotate(360deg);
            }
        }

        .health-item {
            position: absolute;
            width: 100px;
            height: 100px;
            animation: itemDrop 0.8s ease-out, itemFloat 2s ease-in-out infinite;
            filter: drop-shadow(0 0 15px rgba(0, 255, 0, 0.9));
            z-index: 5;
            pointer-events: none;
        }

        .health-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        @keyframes itemFloat {
            0%, 100% {
                transform: translateY(0px) scale(1) rotate(0deg);
                filter: drop-shadow(0 0 15px rgba(0, 255, 0, 0.9)) brightness(1);
            }
            25% {
                transform: translateY(-8px) scale(1.05) rotate(5deg);
                filter: drop-shadow(0 0 25px rgba(0, 255, 0, 1)) brightness(1.2);
            }
            50% {
                transform: translateY(0px) scale(1.1) rotate(0deg);
                filter: drop-shadow(0 0 30px rgba(0, 255, 0, 1)) brightness(1.3);
            }
            75% {
                transform: translateY(-8px) scale(1.05) rotate(-5deg);
                filter: drop-shadow(0 0 25px rgba(0, 255, 0, 1)) brightness(1.2);
            }
        }

        @keyframes collectItem {
            0% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: scale(1.5) rotate(180deg);
                opacity: 0.8;
                filter: drop-shadow(0 0 40px rgba(0, 255, 0, 1)) brightness(2);
            }
            100% {
                transform: scale(0.2) translateY(-150px) rotate(360deg);
                opacity: 0;
                filter: drop-shadow(0 0 50px rgba(0, 255, 0, 1)) brightness(3);
            }
        }

        .collecting {
            animation: collectItem 0.8s ease-out forwards !important;
        }

        @keyframes itemSparkle {
            0%, 100% {
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
        }

        .health-item::before {
            content: '';
            position: absolute;
            top: -5px;
            right: -5px;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, #fff, #0f0);
            border-radius: 50%;
            animation: itemSparkle 1s ease-in-out infinite;
        }

        .health-item::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: -5px;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #fff, #0f0);
            border-radius: 50%;
            animation: itemSparkle 1s ease-in-out infinite 0.5s;
        }

        .zombie-container {
            position: relative;
            display: inline-block;
        }

        .zombie-image {
            display: block;
            width: 10vw;
            height: 17.5vw;
            object-fit: contain;
        }

        .zombie-text-overlay {
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            border: 0.2vw solid #333;
            border-radius: 0.8vw;
            padding: 0.8vw 1.2vw;
            box-shadow: 0 0.2vw 0.8vw rgba(0,0,0,0.3);
            min-width: 12vw;
            max-width: 30vw;
            text-align: center;
            font-size: 1.2vw;
            white-space: nowrap;
            overflow: visible;
        }

        .dark .zombie-text-overlay {
            background: rgba(31, 41, 55, 0.95);
            border-color: #9ca3af;
        }

        #gameArea {
            background-image: url('images/IMG_2669.PNG');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white font-mono overflow-hidden">
    <!-- Dark mode detection -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <!-- Game Container -->
    <div class="h-screen relative overflow-hidden">
        <!-- Header Stats -->
        <div class="absolute top-0 left-0 right-0 z-10 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm p-4">
            <div class="flex justify-between items-center max-w-6xl mx-auto">
                <div class="flex space-x-6">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-primary" id="score">0</div>
                        <div class="text-xs text-gray-600 dark:text-gray-400">SCORE</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-500" id="wpm">0</div>
                        <div class="text-xs text-gray-600 dark:text-gray-400">WPM</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-500" id="accuracy">100%</div>
                        <div class="text-xs text-gray-600 dark:text-gray-400">ACCURACY</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-purple-500" id="level">1</div>
                        <div class="text-xs text-gray-600 dark:text-gray-400">LEVEL</div>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-center min-w-[200px]">
                        <div class="relative w-48 h-6 bg-gray-300 dark:bg-gray-700 rounded-full overflow-hidden border-2 border-gray-400 dark:border-gray-500">
                            <div id="hpBar" class="absolute top-0 left-0 h-full bg-gradient-to-r from-red-500 to-red-600 transition-all duration-300 ease-out" style="width: 100%"></div>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span class="text-xs font-bold text-white drop-shadow-lg" id="hpText">100 / 100</span>
                            </div>
                        </div>
                        <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">HEALTH</div>
                    </div>
                    <div class="text-center">
                        <div class="text-sm font-bold text-orange-500" id="wordSource">DEFAULT</div>
                        <div class="text-xs text-gray-600 dark:text-gray-400">WORDS</div>
                    </div>
                    <div class="text-center">
                        <div class="text-sm font-bold text-purple-500" id="gameMode">NORMAL</div>
                        <div class="text-xs text-gray-600 dark:text-gray-400">MODE</div>
                    </div>
                    <button id="translationBtn" class="px-3 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors text-sm">
                        ä¸­æ–‡ ON
                    </button>
                    <button id="pauseBtn" class="px-4 py-2 bg-primary text-white rounded hover:bg-primary/80 transition-colors">
                        PAUSE
                    </button>
                    <button id="musicBtn" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors">
                        ğŸ”Š MUSIC
                    </button>
                </div>
            </div>
        </div>

        <!-- Background Music -->
        <audio id="bgMusic" loop>
            <source src="Audio/æ®­å±æœ«æ—¥ç‹‚æ‰“.mp3" type="audio/mpeg">
        </audio>

        <!-- Typing Sound Effect -->
        <audio id="gunshotSound" preload="auto">
            <source src="Sound/Gunshot.wav" type="audio/wav">
        </audio>

        <!-- Game Area -->
        <div id="gameArea" class="h-full relative">
            <!-- Falling zombie words will be added here -->
        </div>

        <!-- Input Area -->
        <div class="absolute bottom-0 left-0 right-0 z-10 bg-white/90 dark:bg-gray-900/90 backdrop-blur-sm p-4">
            <div class="max-w-2xl mx-auto">
                <input
                    type="text"
                    id="wordInput"
                    class="w-full text-2xl p-4 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:border-primary focus:outline-none transition-colors text-base"
                    placeholder="Type the words here..."
                    autocomplete="off"
                    spellcheck="false"
                >
                <div class="mt-2 text-center text-gray-600 dark:text-gray-400">
                    <span id="currentTarget">Start typing to begin!</span>
                </div>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="gameOverScreen" class="absolute inset-0 bg-black/80 flex items-center justify-center z-20 hidden">
            <div class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-2xl text-center max-w-md mx-4">
                <h2 class="text-3xl font-bold mb-4 text-red-500">GAME OVER</h2>
                <div class="space-y-2 mb-6">
                    <p class="text-xl">Final Score: <span id="finalScore" class="font-bold text-primary">0</span></p>
                    <p>Words Per Minute: <span id="finalWpm" class="font-bold text-green-500">0</span></p>
                    <p>Accuracy: <span id="finalAccuracy" class="font-bold text-blue-500">0%</span></p>
                    <p>Level Reached: <span id="finalLevel" class="font-bold text-purple-500">1</span></p>
                </div>
                <button id="restartBtn" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/80 transition-colors">
                    PLAY AGAIN
                </button>
            </div>
        </div>

        <!-- Pause Screen -->
        <div id="pauseScreen" class="absolute inset-0 bg-black/80 flex items-center justify-center z-20 hidden">
            <div class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-2xl text-center">
                <h2 class="text-3xl font-bold mb-6">PAUSED</h2>
                <button id="resumeBtn" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/80 transition-colors">
                    RESUME
                </button>
            </div>
        </div>

        <!-- Start Screen -->
        <div id="startScreen" class="absolute inset-0 bg-gradient-to-br from-primary/20 to-purple-500/20 flex items-center justify-center z-20">
            <div class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-2xl text-center max-w-lg mx-4">
                <h1 class="text-4xl font-bold mb-4 text-primary">TYPING DEFENSE</h1>
                <p class="text-gray-600 dark:text-gray-400 mb-6">
                    Type the approaching words to destroy the zombies before they get too close!<br>
                    Three types of zombies with different movement patterns. Lose all 3 lives and it's game over.
                </p>
                <div class="text-left mb-6 text-sm space-y-1">
                    <p><strong>Controls:</strong></p>
                    <p>â€¢ Type words letter by letter</p>
                    <p>â€¢ Green = typed correctly, Yellow = current letter</p>
                    <p>â€¢ Higher levels = faster zombies</p>
                    <p>â€¢ Longer words = more points</p>
                    <p>â€¢ Press Escape to clear input</p>
                </div>

                <!-- CSV Upload Section -->
                <div class="mb-6 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">
                    <h3 class="text-lg font-bold mb-3">Custom Word List</h3>
                    <div class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                        Upload a CSV file with your own words and translations.<br>
                        Format: <code class="bg-gray-200 dark:bg-gray-600 px-1 rounded">word,translation</code>
                    </div>
                    <div class="flex flex-col space-y-3">
                        <input
                            type="file"
                            id="csvFileInput"
                            accept=".csv,.txt"
                            class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-primary/80"
                        >
                        <div class="flex space-x-2">
                            <button id="loadCsvBtn" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors text-sm">
                                LOAD CSV
                            </button>
                            <button id="clearCsvBtn" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors text-sm">
                                USE DEFAULT
                            </button>
                        </div>
                        <div id="csvStatus" class="text-sm"></div>
                    </div>
                </div>

                <!-- Game Mode Selection -->
                <div id="gameModeSection" class="mb-6 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg hidden">
                    <h3 class="text-lg font-bold mb-3">Game Mode</h3>
                    <div class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                        Choose your game mode with custom words.
                    </div>
                    <div class="flex space-x-3">
                        <button id="normalModeBtn" class="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors text-sm">
                            NORMAL MODE
                        </button>
                        <button id="dictationModeBtn" class="px-4 py-2 bg-pink-500 text-white rounded hover:bg-pink-600 transition-colors text-sm">
                            DICTATION MODE
                        </button>
                    </div>
                    <div class="mt-2 text-xs text-gray-600 dark:text-gray-400">
                        Normal: Type English words | Dictation: See Chinese, type English
                    </div>
                </div>

                <button id="startBtn" class="px-8 py-4 bg-primary text-white text-xl rounded-lg hover:bg-primary/80 transition-colors">
                    START GAME
                </button>
            </div>
        </div>
    </div>

    <script>
        class TypingGame {
            constructor() {
                this.words = [
                    // Easy words (3-5 letters) - 300 words
                    { word: 'cat', translation: 'è²“' },
                    { word: 'dog', translation: 'ç‹—' },
                    { word: 'run', translation: 'è·‘' },
                    { word: 'jump', translation: 'è·³' },
                    { word: 'walk', translation: 'èµ°' },
                    { word: 'talk', translation: 'èªªè©±' },
                    { word: 'read', translation: 'è®€' },
                    { word: 'book', translation: 'æ›¸' },
                    { word: 'play', translation: 'ç©' },
                    { word: 'game', translation: 'éŠæˆ²' },
                    { word: 'fire', translation: 'ç«' },
                    { word: 'water', translation: 'æ°´' },
                    { word: 'earth', translation: 'åœ°çƒ' },
                    { word: 'wind', translation: 'é¢¨' },
                    { word: 'light', translation: 'å…‰' },
                    { word: 'dark', translation: 'æš—' },
                    { word: 'fast', translation: 'å¿«' },
                    { word: 'slow', translation: 'æ…¢' },
                    { word: 'big', translation: 'å¤§' },
                    { word: 'small', translation: 'å°' },
                    { word: 'happy', translation: 'å¿«æ¨‚' },
                    { word: 'angry', translation: 'ç”Ÿæ°£' },
                    { word: 'quick', translation: 'è¿…é€Ÿ' },
                    { word: 'brown', translation: 'æ£•è‰²' },
                    { word: 'black', translation: 'é»‘è‰²' },
                    { word: 'white', translation: 'ç™½è‰²' },
                    { word: 'green', translation: 'ç¶ è‰²' },
                    { word: 'music', translation: 'éŸ³æ¨‚' },
                    { word: 'dance', translation: 'è·³èˆ' },
                    { word: 'write', translation: 'å¯«' },
                    { word: 'bird', translation: 'é³¥' },
                    { word: 'fish', translation: 'é­š' },
                    { word: 'tree', translation: 'æ¨¹' },
                    { word: 'sun', translation: 'å¤ªé™½' },
                    { word: 'moon', translation: 'æœˆäº®' },
                    { word: 'star', translation: 'æ˜Ÿæ˜Ÿ' },
                    { word: 'rain', translation: 'é›¨' },
                    { word: 'snow', translation: 'é›ª' },
                    { word: 'cloud', translation: 'é›²' },
                    { word: 'house', translation: 'æˆ¿å­' },
                    { word: 'home', translation: 'å®¶' },
                    { word: 'door', translation: 'é–€' },
                    { word: 'chair', translation: 'æ¤…å­' },
                    { word: 'table', translation: 'æ¡Œå­' },
                    { word: 'bed', translation: 'åºŠ' },
                    { word: 'room', translation: 'æˆ¿é–“' },
                    { word: 'wall', translation: 'ç‰†' },
                    { word: 'floor', translation: 'åœ°æ¿' },
                    { word: 'roof', translation: 'å±‹é ‚' },
                    { word: 'car', translation: 'æ±½è»Š' },
                    { word: 'bus', translation: 'å…¬è»Š' },
                    { word: 'train', translation: 'ç«è»Š' },
                    { word: 'plane', translation: 'é£›æ©Ÿ' },
                    { word: 'boat', translation: 'èˆ¹' },
                    { word: 'bike', translation: 'è…³è¸è»Š' },
                    { word: 'road', translation: 'é“è·¯' },
                    { word: 'path', translation: 'å°å¾‘' },
                    { word: 'city', translation: 'åŸå¸‚' },
                    { word: 'town', translation: 'åŸé®' },
                    { word: 'shop', translation: 'å•†åº—' },
                    { word: 'park', translation: 'å…¬åœ’' },
                    { word: 'food', translation: 'é£Ÿç‰©' },
                    { word: 'rice', translation: 'ç±³é£¯' },
                    { word: 'bread', translation: 'éºµåŒ…' },
                    { word: 'meat', translation: 'è‚‰' },
                    { word: 'milk', translation: 'ç‰›å¥¶' },
                    { word: 'egg', translation: 'è›‹' },
                    { word: 'fruit', translation: 'æ°´æœ' },
                    { word: 'apple', translation: 'è˜‹æœ' },
                    { word: 'grape', translation: 'è‘¡è„' },
                    { word: 'lemon', translation: 'æª¸æª¬' },
                    { word: 'peach', translation: 'æ¡ƒå­' },
                    { word: 'tea', translation: 'èŒ¶' },
                    { word: 'drink', translation: 'é£²æ–™' },
                    { word: 'eat', translation: 'åƒ' },
                    { word: 'cook', translation: 'ç…®' },
                    { word: 'hand', translation: 'æ‰‹' },
                    { word: 'foot', translation: 'è…³' },
                    { word: 'head', translation: 'é ­' },
                    { word: 'face', translation: 'è‡‰' },
                    { word: 'eye', translation: 'çœ¼ç›' },
                    { word: 'ear', translation: 'è€³æœµ' },
                    { word: 'nose', translation: 'é¼»å­' },
                    { word: 'mouth', translation: 'å˜´å·´' },
                    { word: 'hair', translation: 'é ­é«®' },
                    { word: 'arm', translation: 'æ‰‹è‡‚' },
                    { word: 'leg', translation: 'è…¿' },
                    { word: 'body', translation: 'èº«é«”' },
                    { word: 'bone', translation: 'éª¨é ­' },
                    { word: 'skin', translation: 'çš®è†š' },
                    { word: 'red', translation: 'ç´…è‰²' },
                    { word: 'blue', translation: 'è—è‰²' },
                    { word: 'gray', translation: 'ç°è‰²' },
                    { word: 'pink', translation: 'ç²‰ç´…è‰²' },
                    { word: 'gold', translation: 'é‡‘è‰²' },
                    { word: 'cold', translation: 'å†·' },
                    { word: 'hot', translation: 'ç†±' },
                    { word: 'warm', translation: 'æº«æš–' },
                    { word: 'cool', translation: 'æ¶¼çˆ½' },
                    { word: 'new', translation: 'æ–°çš„' },
                    { word: 'old', translation: 'èˆŠçš„' },
                    { word: 'good', translation: 'å¥½çš„' },
                    { word: 'bad', translation: 'å£çš„' },
                    { word: 'high', translation: 'é«˜' },
                    { word: 'low', translation: 'ä½' },
                    { word: 'long', translation: 'é•·' },
                    { word: 'short', translation: 'çŸ­' },
                    { word: 'wide', translation: 'å¯¬' },
                    { word: 'thin', translation: 'ç˜¦' },
                    { word: 'thick', translation: 'åš' },
                    { word: 'clean', translation: 'ä¹¾æ·¨' },
                    { word: 'dirty', translation: 'é«’' },
                    { word: 'left', translation: 'å·¦é‚Š' },
                    { word: 'right', translation: 'å³é‚Š' },
                    { word: 'front', translation: 'å‰é¢' },
                    { word: 'back', translation: 'å¾Œé¢' },
                    { word: 'top', translation: 'é ‚éƒ¨' },
                    { word: 'side', translation: 'æ—é‚Š' },
                    { word: 'near', translation: 'è¿‘' },
                    { word: 'far', translation: 'é ' },
                    { word: 'up', translation: 'ä¸Š' },
                    { word: 'down', translation: 'ä¸‹' },
                    { word: 'here', translation: 'é€™è£¡' },
                    { word: 'there', translation: 'é‚£è£¡' },
                    { word: 'love', translation: 'æ„›' },
                    { word: 'hate', translation: 'æ¨' },
                    { word: 'like', translation: 'å–œæ­¡' },
                    { word: 'want', translation: 'æƒ³è¦' },
                    { word: 'need', translation: 'éœ€è¦' },
                    { word: 'help', translation: 'å¹«åŠ©' },
                    { word: 'give', translation: 'çµ¦' },
                    { word: 'take', translation: 'æ‹¿' },
                    { word: 'bring', translation: 'å¸¶ä¾†' },
                    { word: 'buy', translation: 'è²·' },
                    { word: 'sell', translation: 'è³£' },
                    { word: 'open', translation: 'æ‰“é–‹' },
                    { word: 'close', translation: 'é—œé–‰' },
                    { word: 'push', translation: 'æ¨' },
                    { word: 'pull', translation: 'æ‹‰' },
                    { word: 'send', translation: 'é€' },
                    { word: 'get', translation: 'å¾—åˆ°' },
                    { word: 'make', translation: 'è£½ä½œ' },
                    { word: 'break', translation: 'æ‰“ç ´' },
                    { word: 'fix', translation: 'ä¿®ç†' },
                    { word: 'find', translation: 'æ‰¾åˆ°' },
                    { word: 'lose', translation: 'å¤±å»' },
                    { word: 'show', translation: 'å±•ç¤º' },
                    { word: 'hide', translation: 'éš±è—' },
                    { word: 'see', translation: 'çœ‹è¦‹' },
                    { word: 'hear', translation: 'è½åˆ°' },
                    { word: 'feel', translation: 'æ„Ÿè¦º' },
                    { word: 'smell', translation: 'è' },
                    { word: 'taste', translation: 'åš' },
                    { word: 'know', translation: 'çŸ¥é“' },
                    { word: 'think', translation: 'æƒ³' },
                    { word: 'hope', translation: 'å¸Œæœ›' },
                    { word: 'wish', translation: 'é¡˜æœ›' },
                    { word: 'dream', translation: 'å¤¢æƒ³' },
                    { word: 'sleep', translation: 'ç¡è¦º' },
                    { word: 'wake', translation: 'é†’ä¾†' },
                    { word: 'work', translation: 'å·¥ä½œ' },
                    { word: 'rest', translation: 'ä¼‘æ¯' },
                    { word: 'study', translation: 'å­¸ç¿’' },
                    { word: 'teach', translation: 'æ•™' },
                    { word: 'learn', translation: 'å­¸' },
                    { word: 'test', translation: 'æ¸¬è©¦' },
                    { word: 'pass', translation: 'é€šé' },
                    { word: 'fail', translation: 'å¤±æ•—' },
                    { word: 'try', translation: 'å˜—è©¦' },
                    { word: 'win', translation: 'è´' },
                    { word: 'draw', translation: 'ç•«' },
                    { word: 'paint', translation: 'ç¹ªç•«' },
                    { word: 'sing', translation: 'å”±æ­Œ' },
                    { word: 'laugh', translation: 'ç¬‘' },
                    { word: 'cry', translation: 'å“­' },
                    { word: 'smile', translation: 'å¾®ç¬‘' },
                    { word: 'call', translation: 'æ‰“é›»è©±' },
                    { word: 'ask', translation: 'å•' },
                    { word: 'tell', translation: 'å‘Šè¨´' },
                    { word: 'say', translation: 'èªª' },
                    { word: 'speak', translation: 'è¬›' },
                    { word: 'shout', translation: 'å–Š' },
                    { word: 'wait', translation: 'ç­‰å¾…' },
                    { word: 'stop', translation: 'åœæ­¢' },
                    { word: 'start', translation: 'é–‹å§‹' },
                    { word: 'go', translation: 'å»' },
                    { word: 'come', translation: 'ä¾†' },
                    { word: 'stay', translation: 'åœç•™' },
                    { word: 'leave', translation: 'é›¢é–‹' },
                    { word: 'stand', translation: 'ç«™' },
                    { word: 'sit', translation: 'å' },
                    { word: 'fly', translation: 'é£›' },
                    { word: 'swim', translation: 'æ¸¸æ³³' },
                    { word: 'climb', translation: 'çˆ¬' },
                    { word: 'fall', translation: 'æ‰è½' },
                    { word: 'rise', translation: 'ä¸Šå‡' },
                    { word: 'grow', translation: 'æˆé•·' },
                    { word: 'cut', translation: 'åˆ‡' },
                    { word: 'hit', translation: 'æ‰“' },
                    { word: 'kick', translation: 'è¸¢' },
                    { word: 'throw', translation: 'æ‰”' },
                    { word: 'catch', translation: 'æ¥ä½' },
                    { word: 'hold', translation: 'æ¡ä½' },
                    { word: 'touch', translation: 'è§¸æ‘¸' },
                    { word: 'wear', translation: 'ç©¿' },
                    { word: 'use', translation: 'ä½¿ç”¨' },
                    { word: 'turn', translation: 'è½‰' },
                    { word: 'move', translation: 'ç§»å‹•' },
                    { word: 'man', translation: 'ç”·äºº' },
                    { word: 'boy', translation: 'ç”·å­©' },
                    { word: 'girl', translation: 'å¥³å­©' },
                    { word: 'child', translation: 'å­©å­' },
                    { word: 'baby', translation: 'å¬°å…’' },
                    { word: 'dad', translation: 'çˆ¸çˆ¸' },
                    { word: 'mom', translation: 'åª½åª½' },
                    { word: 'son', translation: 'å…’å­' },
                    { word: 'king', translation: 'åœ‹ç‹' },
                    { word: 'queen', translation: 'å¥³ç‹' },
                    { word: 'name', translation: 'åå­—' },
                    { word: 'age', translation: 'å¹´é½¡' },
                    { word: 'year', translation: 'å¹´' },
                    { word: 'day', translation: 'å¤©' },
                    { word: 'week', translation: 'é€±' },
                    { word: 'month', translation: 'æœˆ' },
                    { word: 'hour', translation: 'å°æ™‚' },
                    { word: 'time', translation: 'æ™‚é–“' },
                    { word: 'clock', translation: 'æ™‚é˜' },
                    { word: 'watch', translation: 'æ‰‹éŒ¶' },
                    { word: 'now', translation: 'ç¾åœ¨' },
                    { word: 'today', translation: 'ä»Šå¤©' },
                    { word: 'past', translation: 'éå»' },
                    { word: 'late', translation: 'æ™š' },
                    { word: 'early', translation: 'æ—©' },
                    { word: 'one', translation: 'ä¸€' },
                    { word: 'two', translation: 'äºŒ' },
                    { word: 'three', translation: 'ä¸‰' },
                    { word: 'four', translation: 'å››' },
                    { word: 'five', translation: 'äº”' },
                    { word: 'six', translation: 'å…­' },
                    { word: 'seven', translation: 'ä¸ƒ' },
                    { word: 'eight', translation: 'å…«' },
                    { word: 'nine', translation: 'ä¹' },
                    { word: 'ten', translation: 'å' },
                    { word: 'first', translation: 'ç¬¬ä¸€' },
                    { word: 'last', translation: 'æœ€å¾Œ' },
                    { word: 'next', translation: 'ä¸‹ä¸€å€‹' },
                    { word: 'some', translation: 'ä¸€äº›' },
                    { word: 'many', translation: 'å¾ˆå¤š' },
                    { word: 'few', translation: 'å°‘æ•¸' },
                    { word: 'all', translation: 'å…¨éƒ¨' },
                    { word: 'none', translation: 'æ²’æœ‰' },
                    { word: 'much', translation: 'è¨±å¤š' },
                    { word: 'more', translation: 'æ›´å¤š' },
                    { word: 'less', translation: 'æ›´å°‘' },
                    { word: 'most', translation: 'æœ€å¤š' },
                    { word: 'best', translation: 'æœ€å¥½' },
                    { word: 'same', translation: 'ç›¸åŒ' },
                    { word: 'half', translation: 'ä¸€åŠ' },
                    { word: 'full', translation: 'æ»¿çš„' },
                    { word: 'empty', translation: 'ç©ºçš„' },
                    { word: 'true', translation: 'çœŸçš„' },
                    { word: 'false', translation: 'å‡çš„' },
                    { word: 'real', translation: 'çœŸå¯¦' },
                    { word: 'safe', translation: 'å®‰å…¨' },
                    { word: 'easy', translation: 'ç°¡å–®' },
                    { word: 'hard', translation: 'å›°é›£' },
                    { word: 'loud', translation: 'å¤§è²' },
                    { word: 'quiet', translation: 'å®‰éœ' },
                    { word: 'heavy', translation: 'é‡' },
                    { word: 'wrong', translation: 'éŒ¯èª¤' },
                    { word: 'rich', translation: 'å¯Œæœ‰' },
                    { word: 'poor', translation: 'è²§çª®' },
                    { word: 'young', translation: 'å¹´è¼•' },
                    { word: 'smart', translation: 'è°æ˜' },
                    { word: 'kind', translation: 'å–„è‰¯' },
                    { word: 'brave', translation: 'å‹‡æ•¢' },
                    { word: 'nice', translation: 'å¥½çš„' },
                    { word: 'soft', translation: 'è»Ÿçš„' },
                    { word: 'wet', translation: 'æ¿•çš„' },
                    { word: 'dry', translation: 'ä¹¾çš„' },
                    { word: 'deep', translation: 'æ·±' },
                    { word: 'flat', translation: 'å¹³çš„' },
                    { word: 'sharp', translation: 'å°–çš„' },
                    { word: 'dull', translation: 'éˆçš„' },
                    { word: 'rough', translation: 'ç²—ç³™' },
                    { word: 'clear', translation: 'æ¸…æ¥š' },
                    { word: 'sunny', translation: 'æ™´æœ—' },
                    { word: 'windy', translation: 'æœ‰é¢¨' },
                    { word: 'rainy', translation: 'ä¸‹é›¨' },
                    { word: 'bell', translation: 'éˆ´' },
                    { word: 'flag', translation: 'æ——' },
                    { word: 'key', translation: 'é‘°åŒ™' },
                    { word: 'lock', translation: 'é–' },
                    { word: 'box', translation: 'ç›’å­' },
                    { word: 'bag', translation: 'è¢‹å­' },
                    { word: 'ball', translation: 'çƒ' },
                    { word: 'toy', translation: 'ç©å…·' },
                    { word: 'pen', translation: 'ç­†' },
                    { word: 'map', translation: 'åœ°åœ–' },
                    { word: 'cup', translation: 'æ¯å­' },
                    { word: 'bowl', translation: 'ç¢—' },
                    { word: 'dish', translation: 'ç›¤å­' },
                    { word: 'fork', translation: 'å‰å­' },
                    { word: 'spoon', translation: 'æ¹¯åŒ™' },
                    { word: 'knife', translation: 'åˆ€' },
                    { word: 'glass', translation: 'ç»ç’ƒ' },
                    { word: 'plate', translation: 'ç›¤å­' },
                    { word: 'salt', translation: 'é¹½' },
                    { word: 'sugar', translation: 'ç³–' },
                    { word: 'oil', translation: 'æ²¹' },
                    { word: 'soup', translation: 'æ¹¯' },
                    { word: 'cake', translation: 'è›‹ç³•' },

                    // Medium words (6-8 letters) - 250 words
                    { word: 'computer', translation: 'é›»è…¦' },
                    { word: 'keyboard', translation: 'éµç›¤' },
                    { word: 'monitor', translation: 'è¢å¹•' },
                    { word: 'speaker', translation: 'æšè²å™¨' },
                    { word: 'printer', translation: 'å°è¡¨æ©Ÿ' },
                    { word: 'network', translation: 'ç¶²è·¯' },
                    { word: 'internet', translation: 'ç¶²éš›ç¶²è·¯' },
                    { word: 'website', translation: 'ç¶²ç«™' },
                    { word: 'download', translation: 'ä¸‹è¼‰' },
                    { word: 'upload', translation: 'ä¸Šå‚³' },
                    { word: 'software', translation: 'è»Ÿé«”' },
                    { word: 'hardware', translation: 'ç¡¬é«”' },
                    { word: 'program', translation: 'ç¨‹å¼' },
                    { word: 'function', translation: 'åŠŸèƒ½' },
                    { word: 'variable', translation: 'è®Šæ•¸' },
                    { word: 'database', translation: 'è³‡æ–™åº«' },
                    { word: 'graphics', translation: 'åœ–å½¢' },
                    { word: 'digital', translation: 'æ•¸ä½' },
                    { word: 'virtual', translation: 'è™›æ“¬' },
                    { word: 'machine', translation: 'æ©Ÿå™¨' },
                    { word: 'science', translation: 'ç§‘å­¸' },
                    { word: 'technology', translation: 'æŠ€è¡“' },
                    { word: 'advanced', translation: 'å…ˆé€²' },
                    { word: 'modern', translation: 'ç¾ä»£' },
                    { word: 'animal', translation: 'å‹•ç‰©' },
                    { word: 'flower', translation: 'èŠ±' },
                    { word: 'garden', translation: 'èŠ±åœ’' },
                    { word: 'forest', translation: 'æ£®æ—' },
                    { word: 'mountain', translation: 'å±±' },
                    { word: 'river', translation: 'æ²³' },
                    { word: 'ocean', translation: 'æµ·æ´‹' },
                    { word: 'beach', translation: 'æµ·ç˜' },
                    { word: 'island', translation: 'å³¶' },
                    { word: 'bridge', translation: 'æ©‹' },
                    { word: 'building', translation: 'å»ºç¯‰' },
                    { word: 'school', translation: 'å­¸æ ¡' },
                    { word: 'hospital', translation: 'é†«é™¢' },
                    { word: 'library', translation: 'åœ–æ›¸é¤¨' },
                    { word: 'museum', translation: 'åšç‰©é¤¨' },
                    { word: 'church', translation: 'æ•™å ‚' },
                    { word: 'temple', translation: 'å¯ºå»Ÿ' },
                    { word: 'office', translation: 'è¾¦å…¬å®¤' },
                    { word: 'station', translation: 'è»Šç«™' },
                    { word: 'airport', translation: 'æ©Ÿå ´' },
                    { word: 'market', translation: 'å¸‚å ´' },
                    { word: 'store', translation: 'å•†åº—' },
                    { word: 'factory', translation: 'å·¥å» ' },
                    { word: 'kitchen', translation: 'å»šæˆ¿' },
                    { word: 'bedroom', translation: 'è‡¥å®¤' },
                    { word: 'bathroom', translation: 'æµ´å®¤' },
                    { word: 'window', translation: 'çª—æˆ¶' },
                    { word: 'picture', translation: 'åœ–ç‰‡' },
                    { word: 'mirror', translation: 'é¡å­' },
                    { word: 'carpet', translation: 'åœ°æ¯¯' },
                    { word: 'curtain', translation: 'çª—ç°¾' },
                    { word: 'blanket', translation: 'æ¯¯å­' },
                    { word: 'pillow', translation: 'æ•é ­' },
                    { word: 'towel', translation: 'æ¯›å·¾' },
                    { word: 'basket', translation: 'ç±ƒå­' },
                    { word: 'bottle', translation: 'ç“¶å­' },
                    { word: 'bucket', translation: 'æ°´æ¡¶' },
                    { word: 'button', translation: 'æŒ‰éˆ•' },
                    { word: 'camera', translation: 'ç›¸æ©Ÿ' },
                    { word: 'candle', translation: 'è Ÿç‡­' },
                    { word: 'corner', translation: 'è§’è½' },
                    { word: 'cotton', translation: 'æ£‰èŠ±' },
                    { word: 'doctor', translation: 'é†«ç”Ÿ' },
                    { word: 'driver', translation: 'å¸æ©Ÿ' },
                    { word: 'farmer', translation: 'è¾²å¤«' },
                    { word: 'lawyer', translation: 'å¾‹å¸«' },
                    { word: 'nurse', translation: 'è­·å£«' },
                    { word: 'police', translation: 'è­¦å¯Ÿ' },
                    { word: 'soldier', translation: 'å£«å…µ' },
                    { word: 'teacher', translation: 'è€å¸«' },
                    { word: 'worker', translation: 'å·¥äºº' },
                    { word: 'writer', translation: 'ä½œå®¶' },
                    { word: 'artist', translation: 'è—è¡“å®¶' },
                    { word: 'singer', translation: 'æ­Œæ‰‹' },
                    { word: 'dancer', translation: 'èˆè€…' },
                    { word: 'player', translation: 'é¸æ‰‹' },
                    { word: 'actor', translation: 'æ¼”å“¡' },
                    { word: 'director', translation: 'å°æ¼”' },
                    { word: 'manager', translation: 'ç¶“ç†' },
                    { word: 'engineer', translation: 'å·¥ç¨‹å¸«' },
                    { word: 'designer', translation: 'è¨­è¨ˆå¸«' },
                    { word: 'painter', translation: 'ç•«å®¶' },
                    { word: 'scientist', translation: 'ç§‘å­¸å®¶' },
                    { word: 'student', translation: 'å­¸ç”Ÿ' },
                    { word: 'brother', translation: 'å…„å¼Ÿ' },
                    { word: 'sister', translation: 'å§å¦¹' },
                    { word: 'father', translation: 'çˆ¶è¦ª' },
                    { word: 'mother', translation: 'æ¯è¦ª' },
                    { word: 'parent', translation: 'çˆ¶æ¯' },
                    { word: 'family', translation: 'å®¶åº­' },
                    { word: 'friend', translation: 'æœ‹å‹' },
                    { word: 'neighbor', translation: 'é„°å±…' },
                    { word: 'stranger', translation: 'é™Œç”Ÿäºº' },
                    { word: 'visitor', translation: 'è¨ªå®¢' },
                    { word: 'guest', translation: 'å®¢äºº' },
                    { word: 'leader', translation: 'é ˜è¢–' },
                    { word: 'member', translation: 'æˆå“¡' },
                    { word: 'partner', translation: 'å¤¥ä¼´' },
                    { word: 'person', translation: 'äºº' },
                    { word: 'people', translation: 'äººå€‘' },
                    { word: 'morning', translation: 'æ—©ä¸Š' },
                    { word: 'evening', translation: 'æ™šä¸Š' },
                    { word: 'night', translation: 'å¤œæ™š' },
                    { word: 'noon', translation: 'ä¸­åˆ' },
                    { word: 'minute', translation: 'åˆ†é˜' },
                    { word: 'second', translation: 'ç§’' },
                    { word: 'moment', translation: 'ç‰‡åˆ»' },
                    { word: 'period', translation: 'æœŸé–“' },
                    { word: 'season', translation: 'å­£ç¯€' },
                    { word: 'spring', translation: 'æ˜¥å¤©' },
                    { word: 'summer', translation: 'å¤å¤©' },
                    { word: 'autumn', translation: 'ç§‹å¤©' },
                    { word: 'winter', translation: 'å†¬å¤©' },
                    { word: 'weather', translation: 'å¤©æ°£' },
                    { word: 'climate', translation: 'æ°£å€™' },
                    { word: 'storm', translation: 'æš´é¢¨é›¨' },
                    { word: 'thunder', translation: 'é›·' },
                    { word: 'rainbow', translation: 'å½©è™¹' },
                    { word: 'sunshine', translation: 'é™½å…‰' },
                    { word: 'shadow', translation: 'å½±å­' },
                    { word: 'chicken', translation: 'é›' },
                    { word: 'duck', translation: 'é´¨' },
                    { word: 'horse', translation: 'é¦¬' },
                    { word: 'sheep', translation: 'ç¾Š' },
                    { word: 'rabbit', translation: 'å…”å­' },
                    { word: 'mouse', translation: 'è€é¼ ' },
                    { word: 'monkey', translation: 'çŒ´å­' },
                    { word: 'elephant', translation: 'å¤§è±¡' },
                    { word: 'lion', translation: 'ç…å­' },
                    { word: 'tiger', translation: 'è€è™' },
                    { word: 'bear', translation: 'ç†Š' },
                    { word: 'wolf', translation: 'ç‹¼' },
                    { word: 'snake', translation: 'è›‡' },
                    { word: 'turtle', translation: 'çƒé¾œ' },
                    { word: 'insect', translation: 'æ˜†èŸ²' },
                    { word: 'spider', translation: 'èœ˜è››' },
                    { word: 'branch', translation: 'æ¨¹æ' },
                    { word: 'grass', translation: 'è‰' },
                    { word: 'leaf', translation: 'è‘‰å­' },
                    { word: 'seed', translation: 'ç¨®å­' },
                    { word: 'plant', translation: 'æ¤ç‰©' },
                    { word: 'orange', translation: 'æ©™å­' },
                    { word: 'banana', translation: 'é¦™è•‰' },
                    { word: 'cherry', translation: 'æ«»æ¡ƒ' },
                    { word: 'melon', translation: 'ç“œ' },
                    { word: 'potato', translation: 'é¦¬éˆ´è–¯' },
                    { word: 'tomato', translation: 'ç•ªèŒ„' },
                    { word: 'carrot', translation: 'ç´…è˜¿è””' },
                    { word: 'onion', translation: 'æ´‹è”¥' },
                    { word: 'pepper', translation: 'è¾£æ¤’' },
                    { word: 'cheese', translation: 'èµ·å¸' },
                    { word: 'butter', translation: 'å¥¶æ²¹' },
                    { word: 'cream', translation: 'å¥¶æ²¹' },
                    { word: 'yogurt', translation: 'å„ªæ ¼' },
                    { word: 'honey', translation: 'èœ‚èœœ' },
                    { word: 'candy', translation: 'ç³–æœ' },
                    { word: 'cookie', translation: 'é¤…ä¹¾' },
                    { word: 'pizza', translation: 'æŠ«è–©' },
                    { word: 'burger', translation: 'æ¼¢å ¡' },
                    { word: 'salad', translation: 'æ²™æ‹‰' },
                    { word: 'sauce', translation: 'é†¬æ±' },
                    { word: 'dinner', translation: 'æ™šé¤' },
                    { word: 'lunch', translation: 'åˆé¤' },
                    { word: 'breakfast', translation: 'æ—©é¤' },
                    { word: 'meal', translation: 'é¤' },
                    { word: 'snack', translation: 'é»å¿ƒ' },
                    { word: 'coffee', translation: 'å’–å•¡' },
                    { word: 'juice', translation: 'æœæ±' },
                    { word: 'water', translation: 'æ°´' },
                    { word: 'bottle', translation: 'ç“¶å­' },
                    { word: 'clothes', translation: 'è¡£æœ' },
                    { word: 'shirt', translation: 'è¥¯è¡«' },
                    { word: 'pants', translation: 'è¤²å­' },
                    { word: 'dress', translation: 'æ´‹è£' },
                    { word: 'skirt', translation: 'è£™å­' },
                    { word: 'coat', translation: 'å¤–å¥—' },
                    { word: 'jacket', translation: 'å¤¾å…‹' },
                    { word: 'sweater', translation: 'æ¯›è¡£' },
                    { word: 'shoes', translation: 'é‹å­' },
                    { word: 'boots', translation: 'é´å­' },
                    { word: 'socks', translation: 'è¥ªå­' },
                    { word: 'gloves', translation: 'æ‰‹å¥—' },
                    { word: 'scarf', translation: 'åœå·¾' },
                    { word: 'pocket', translation: 'å£è¢‹' },
                    { word: 'zipper', translation: 'æ‹‰éŠ' },
                    { word: 'belt', translation: 'çš®å¸¶' },
                    { word: 'ring', translation: 'æˆ’æŒ‡' },
                    { word: 'watch', translation: 'æ‰‹éŒ¶' },
                    { word: 'necklace', translation: 'é …éŠ' },
                    { word: 'glasses', translation: 'çœ¼é¡' },
                    { word: 'umbrella', translation: 'é›¨å‚˜' },
                    { word: 'wallet', translation: 'éŒ¢åŒ…' },
                    { word: 'purse', translation: 'éŒ¢åŒ…' },
                    { word: 'pocket', translation: 'å£è¢‹' },
                    { word: 'paper', translation: 'ç´™' },
                    { word: 'pencil', translation: 'é‰›ç­†' },
                    { word: 'eraser', translation: 'æ©¡çš®æ“¦' },
                    { word: 'ruler', translation: 'å°º' },
                    { word: 'scissors', translation: 'å‰ªåˆ€' },
                    { word: 'glue', translation: 'è† æ°´' },
                    { word: 'tape', translation: 'è† å¸¶' },
                    { word: 'chalk', translation: 'ç²‰ç­†' },
                    { word: 'marker', translation: 'éº¥å…‹ç­†' },
                    { word: 'crayon', translation: 'è Ÿç­†' },
                    { word: 'brush', translation: 'åˆ·å­' },
                    { word: 'color', translation: 'é¡è‰²' },
                    { word: 'shape', translation: 'å½¢ç‹€' },
                    { word: 'circle', translation: 'åœ“å½¢' },
                    { word: 'square', translation: 'æ­£æ–¹å½¢' },
                    { word: 'triangle', translation: 'ä¸‰è§’å½¢' },
                    { word: 'line', translation: 'ç·š' },
                    { word: 'point', translation: 'é»' },
                    { word: 'angle', translation: 'è§’åº¦' },
                    { word: 'center', translation: 'ä¸­å¿ƒ' },
                    { word: 'edge', translation: 'é‚Šç·£' },
                    { word: 'corner', translation: 'è§’è½' },
                    { word: 'surface', translation: 'è¡¨é¢' },
                    { word: 'inside', translation: 'å…§éƒ¨' },
                    { word: 'outside', translation: 'å¤–éƒ¨' },
                    { word: 'middle', translation: 'ä¸­é–“' },
                    { word: 'between', translation: 'ä¹‹é–“' },
                    { word: 'across', translation: 'ç©¿é' },
                    { word: 'through', translation: 'é€šé' },
                    { word: 'around', translation: 'å‘¨åœ' },
                    { word: 'behind', translation: 'å¾Œé¢' },
                    { word: 'beside', translation: 'æ—é‚Š' },
                    { word: 'under', translation: 'ä¸‹é¢' },
                    { word: 'above', translation: 'ä¸Šé¢' },
                    { word: 'below', translation: 'ä¸‹é¢' },
                    { word: 'over', translation: 'ä¸Šæ–¹' },

                    // Hard words (9+ letters) - 200 words
                    { word: 'programming', translation: 'ç¨‹å¼è¨­è¨ˆ' },
                    { word: 'development', translation: 'é–‹ç™¼' },
                    { word: 'algorithm', translation: 'æ¼”ç®—æ³•' },
                    { word: 'structure', translation: 'çµæ§‹' },
                    { word: 'framework', translation: 'æ¡†æ¶' },
                    { word: 'architecture', translation: 'æ¶æ§‹' },
                    { word: 'optimization', translation: 'æœ€ä½³åŒ–' },
                    { word: 'performance', translation: 'æ•ˆèƒ½' },
                    { word: 'intelligence', translation: 'æ™ºæ…§' },
                    { word: 'automation', translation: 'è‡ªå‹•åŒ–' },
                    { word: 'integration', translation: 'æ•´åˆ' },
                    { word: 'implementation', translation: 'å¯¦ä½œ' },
                    { word: 'communication', translation: 'æºé€š' },
                    { word: 'authentication', translation: 'é©—è­‰' },
                    { word: 'configuration', translation: 'è¨­å®š' },
                    { word: 'documentation', translation: 'æ–‡ä»¶' },
                    { word: 'specification', translation: 'è¦æ ¼' },
                    { word: 'application', translation: 'æ‡‰ç”¨ç¨‹å¼' },
                    { word: 'organization', translation: 'çµ„ç¹”' },
                    { word: 'information', translation: 'è³‡è¨Š' },
                    { word: 'environment', translation: 'ç’°å¢ƒ' },
                    { word: 'education', translation: 'æ•™è‚²' },
                    { word: 'transportation', translation: 'é‹è¼¸' },
                    { word: 'generation', translation: 'ä¸–ä»£' },
                    { word: 'population', translation: 'äººå£' },
                    { word: 'government', translation: 'æ”¿åºœ' },
                    { word: 'management', translation: 'ç®¡ç†' },
                    { word: 'relationship', translation: 'é—œä¿‚' },
                    { word: 'situation', translation: 'æƒ…æ³' },
                    { word: 'temperature', translation: 'æº«åº¦' },
                    { word: 'difference', translation: 'å·®ç•°' },
                    { word: 'important', translation: 'é‡è¦' },
                    { word: 'difficult', translation: 'å›°é›£' },
                    { word: 'beautiful', translation: 'ç¾éº—' },
                    { word: 'wonderful', translation: 'ç¾å¦™' },
                    { word: 'excellent', translation: 'å„ªç§€' },
                    { word: 'dangerous', translation: 'å±éšª' },
                    { word: 'necessary', translation: 'å¿…è¦' },
                    { word: 'possible', translation: 'å¯èƒ½' },
                    { word: 'impossible', translation: 'ä¸å¯èƒ½' },
                    { word: 'available', translation: 'å¯ç”¨' },
                    { word: 'comfortable', translation: 'èˆ’é©' },
                    { word: 'reasonable', translation: 'åˆç†' },
                    { word: 'responsible', translation: 'è² è²¬' },
                    { word: 'successful', translation: 'æˆåŠŸ' },
                    { word: 'powerful', translation: 'å¼·å¤§' },
                    { word: 'peaceful', translation: 'å’Œå¹³' },
                    { word: 'careful', translation: 'å°å¿ƒ' },
                    { word: 'useful', translation: 'æœ‰ç”¨' },
                    { word: 'helpful', translation: 'æœ‰å¹«åŠ©' },
                    { word: 'colorful', translation: 'å¤šå½©' },
                    { word: 'cheerful', translation: 'å¿«æ¨‚' },
                    { word: 'wonderful', translation: 'ç²¾å½©' },
                    { word: 'meaningful', translation: 'æœ‰æ„ç¾©' },
                    { word: 'traditional', translation: 'å‚³çµ±' },
                    { word: 'international', translation: 'åœ‹éš›' },
                    { word: 'professional', translation: 'å°ˆæ¥­' },
                    { word: 'national', translation: 'åœ‹å®¶' },
                    { word: 'personal', translation: 'å€‹äºº' },
                    { word: 'natural', translation: 'è‡ªç„¶' },
                    { word: 'cultural', translation: 'æ–‡åŒ–' },
                    { word: 'physical', translation: 'èº«é«”' },
                    { word: 'chemical', translation: 'åŒ–å­¸' },
                    { word: 'medical', translation: 'é†«ç™‚' },
                    { word: 'electrical', translation: 'é›»æ°£' },
                    { word: 'mechanical', translation: 'æ©Ÿæ¢°' },
                    { word: 'historical', translation: 'æ­·å²' },
                    { word: 'practical', translation: 'å¯¦ç”¨' },
                    { word: 'typical', translation: 'å…¸å‹' },
                    { word: 'critical', translation: 'é—œéµ' },
                    { word: 'original', translation: 'åŸå§‹' },
                    { word: 'official', translation: 'å®˜æ–¹' },
                    { word: 'familiar', translation: 'ç†Ÿæ‚‰' },
                    { word: 'particular', translation: 'ç‰¹åˆ¥' },
                    { word: 'regular', translation: 'å¸¸è¦' },
                    { word: 'popular', translation: 'æµè¡Œ' },
                    { word: 'similar', translation: 'ç›¸ä¼¼' },
                    { word: 'different', translation: 'ä¸åŒ' },
                    { word: 'significant', translation: 'é‡è¦' },
                    { word: 'independent', translation: 'ç¨ç«‹' },
                    { word: 'confident', translation: 'è‡ªä¿¡' },
                    { word: 'efficient', translation: 'æœ‰æ•ˆç‡' },
                    { word: 'sufficient', translation: 'å……è¶³' },
                    { word: 'excellent', translation: 'å“è¶Š' },
                    { word: 'brilliant', translation: 'è°æ˜' },
                    { word: 'frequent', translation: 'é »ç¹' },
                    { word: 'consistent', translation: 'ä¸€è‡´' },
                    { word: 'permanent', translation: 'æ°¸ä¹…' },
                    { word: 'temporary', translation: 'æš«æ™‚' },
                    { word: 'ordinary', translation: 'æ™®é€š' },
                    { word: 'necessary', translation: 'å¿…éœ€' },
                    { word: 'secretary', translation: 'ç§˜æ›¸' },
                    { word: 'dictionary', translation: 'å­—å…¸' },
                    { word: 'machinery', translation: 'æ©Ÿå™¨' },
                    { word: 'discovery', translation: 'ç™¼ç¾' },
                    { word: 'recovery', translation: 'æ¢å¾©' },
                    { word: 'delivery', translation: 'äº¤ä»˜' },
                    { word: 'gallery', translation: 'ç•«å»Š' },
                    { word: 'category', translation: 'é¡åˆ¥' },
                    { word: 'strategy', translation: 'ç­–ç•¥' },
                    { word: 'energy', translation: 'èƒ½é‡' },
                    { word: 'memory', translation: 'è¨˜æ†¶' },
                    { word: 'history', translation: 'æ­·å²' },
                    { word: 'mystery', translation: 'ç¥ç§˜' },
                    { word: 'victory', translation: 'å‹åˆ©' },
                    { word: 'factory', translation: 'å·¥å» ' },
                    { word: 'directory', translation: 'ç›®éŒ„' },
                    { word: 'territory', translation: 'é ˜åœŸ' },
                    { word: 'laboratory', translation: 'å¯¦é©—å®¤' },
                    { word: 'vocabulary', translation: 'è©å½™' },
                    { word: 'capacity', translation: 'å®¹é‡' },
                    { word: 'facility', translation: 'è¨­æ–½' },
                    { word: 'ability', translation: 'èƒ½åŠ›' },
                    { word: 'quality', translation: 'å“è³ª' },
                    { word: 'quantity', translation: 'æ•¸é‡' },
                    { word: 'community', translation: 'ç¤¾å€' },
                    { word: 'opportunity', translation: 'æ©Ÿæœƒ' },
                    { word: 'university', translation: 'å¤§å­¸' },
                    { word: 'security', translation: 'å®‰å…¨' },
                    { word: 'authority', translation: 'æ¬Šå¨' },
                    { word: 'majority', translation: 'å¤šæ•¸' },
                    { word: 'minority', translation: 'å°‘æ•¸' },
                    { word: 'priority', translation: 'å„ªå…ˆ' },
                    { word: 'activity', translation: 'æ´»å‹•' },
                    { word: 'difficulty', translation: 'å›°é›£' },
                    { word: 'possibility', translation: 'å¯èƒ½æ€§' },
                    { word: 'responsibility', translation: 'è²¬ä»»' },
                    { word: 'personality', translation: 'å€‹æ€§' },
                    { word: 'nationality', translation: 'åœ‹ç±' },
                    { word: 'curiosity', translation: 'å¥½å¥‡å¿ƒ' },
                    { word: 'electricity', translation: 'é›»åŠ›' },
                    { word: 'simplicity', translation: 'ç°¡å–®' },
                    { word: 'complexity', translation: 'è¤‡é›œ' },
                    { word: 'diversity', translation: 'å¤šæ¨£æ€§' },
                    { word: 'university', translation: 'å¤§å­¸' },
                    { word: 'emergency', translation: 'ç·Šæ€¥' },
                    { word: 'frequency', translation: 'é »ç‡' },
                    { word: 'tendency', translation: 'è¶¨å‹¢' },
                    { word: 'efficiency', translation: 'æ•ˆç‡' },
                    { word: 'pregnancy', translation: 'æ‡·å­•' },
                    { word: 'currency', translation: 'è²¨å¹£' },
                    { word: 'accuracy', translation: 'æº–ç¢º' },
                    { word: 'democracy', translation: 'æ°‘ä¸»' },
                    { word: 'diplomacy', translation: 'å¤–äº¤' },
                    { word: 'pharmacy', translation: 'è—¥æˆ¿' },
                    { word: 'privacy', translation: 'éš±ç§' },
                    { word: 'literacy', translation: 'è­˜å­—' },
                    { word: 'warranty', translation: 'ä¿è­‰' },
                    { word: 'ceremony', translation: 'å„€å¼' },
                    { word: 'harmony', translation: 'å’Œè«§' },
                    { word: 'testimony', translation: 'è­‰è©' },
                    { word: 'matrimony', translation: 'å©šå§»' },
                    { word: 'symphony', translation: 'äº¤éŸ¿æ¨‚' },
                    { word: 'astronomy', translation: 'å¤©æ–‡å­¸' },
                    { word: 'economy', translation: 'ç¶“æ¿Ÿ' },
                    { word: 'autonomy', translation: 'è‡ªæ²»' },
                    { word: 'anatomy', translation: 'è§£å‰–å­¸' },
                    { word: 'gastronomy', translation: 'ç¾é£Ÿå­¸' },
                    { word: 'philosophy', translation: 'å“²å­¸' },
                    { word: 'psychology', translation: 'å¿ƒç†å­¸' },
                    { word: 'biology', translation: 'ç”Ÿç‰©å­¸' },
                    { word: 'sociology', translation: 'ç¤¾æœƒå­¸' },
                    { word: 'technology', translation: 'ç§‘æŠ€' },
                    { word: 'mythology', translation: 'ç¥è©±' },
                    { word: 'archaeology', translation: 'è€ƒå¤å­¸' },
                    { word: 'geography', translation: 'åœ°ç†' },
                    { word: 'photography', translation: 'æ”å½±' },
                    { word: 'biography', translation: 'å‚³è¨˜' },
                    { word: 'bibliography', translation: 'æ›¸ç›®' },
                    { word: 'calligraphy', translation: 'æ›¸æ³•' },
                    { word: 'choreography', translation: 'ç·¨èˆ' },
                    { word: 'typography', translation: 'æ’ç‰ˆ' },
                    { word: 'topography', translation: 'åœ°å½¢' },
                    { word: 'oceanography', translation: 'æµ·æ´‹å­¸' },
                    { word: 'methodology', translation: 'æ–¹æ³•è«–' },
                    { word: 'terminology', translation: 'è¡“èª' },
                    { word: 'chronology', translation: 'å¹´è¡¨' },
                    { word: 'genealogy', translation: 'å®¶è­œ' },
                    { word: 'anthology', translation: 'é¸é›†' },
                    { word: 'apology', translation: 'é“æ­‰' },
                    { word: 'analogy', translation: 'é¡æ¯”' },
                    { word: 'trilogy', translation: 'ä¸‰éƒ¨æ›²' }
                ];

                this.zombieTypes = ['zombie1', 'zombie2', 'zombie3'];
                this.zombieImages = {
                    zombie1: 'images/Zombie1.png',
                    zombie2: 'images/Zombie2.png',
                    zombie3: 'images/Zombie3.png'
                };

                // Zombie stats: attack damage
                this.zombieStats = {
                    zombie1: { damage: 10, name: 'Walker' },
                    zombie2: { damage: 15, name: 'Swinger' },
                    zombie3: { damage: 20, name: 'Rusher' }
                };

                this.gameState = {
                    isPlaying: false,
                    isPaused: false,
                    score: 0,
                    hp: 100,
                    maxHp: 100,
                    level: 1,
                    wordsTyped: 0,
                    totalCharacters: 0,
                    correctCharacters: 0,
                    startTime: null,
                    fallingWords: [],
                    wordIdCounter: 0,
                    showTranslation: true,
                    gameMode: 'normal', // 'normal' or 'dictation'
                    healthItems: [],
                    musicEnabled: true
                };

                this.defaultWords = [...this.words]; // Store original words
                this.customWords = null; // Store custom uploaded words

                this.gameSpeed = 1;
                this.spawnRate = 4000; // milliseconds - slower initial spawn
                this.lastSpawnTime = 0;

                this.initializeElements();
                this.attachEventListeners();
            }

            initializeElements() {
                this.elements = {
                    gameArea: document.getElementById('gameArea'),
                    wordInput: document.getElementById('wordInput'),
                    currentTarget: document.getElementById('currentTarget'),

                    // Stats
                    score: document.getElementById('score'),
                    wpm: document.getElementById('wpm'),
                    accuracy: document.getElementById('accuracy'),
                    level: document.getElementById('level'),
                    hpBar: document.getElementById('hpBar'),
                    hpText: document.getElementById('hpText'),
                    wordSource: document.getElementById('wordSource'),

                    // Screens
                    startScreen: document.getElementById('startScreen'),
                    gameOverScreen: document.getElementById('gameOverScreen'),
                    pauseScreen: document.getElementById('pauseScreen'),

                    // Buttons
                    startBtn: document.getElementById('startBtn'),
                    restartBtn: document.getElementById('restartBtn'),
                    pauseBtn: document.getElementById('pauseBtn'),
                    resumeBtn: document.getElementById('resumeBtn'),
                    translationBtn: document.getElementById('translationBtn'),
                    musicBtn: document.getElementById('musicBtn'),
                    loadCsvBtn: document.getElementById('loadCsvBtn'),
                    clearCsvBtn: document.getElementById('clearCsvBtn'),

                    // Audio
                    bgMusic: document.getElementById('bgMusic'),
                    gunshotSound: document.getElementById('gunshotSound'),

                    // CSV elements
                    csvFileInput: document.getElementById('csvFileInput'),
                    csvStatus: document.getElementById('csvStatus'),

                    // Game mode elements
                    gameModeSection: document.getElementById('gameModeSection'),
                    normalModeBtn: document.getElementById('normalModeBtn'),
                    dictationModeBtn: document.getElementById('dictationModeBtn'),
                    gameMode: document.getElementById('gameMode'),

                    // Final stats
                    finalScore: document.getElementById('finalScore'),
                    finalWpm: document.getElementById('finalWpm'),
                    finalAccuracy: document.getElementById('finalAccuracy'),
                    finalLevel: document.getElementById('finalLevel')
                };
            }

            attachEventListeners() {
                this.elements.startBtn.addEventListener('click', () => this.startGame());
                this.elements.restartBtn.addEventListener('click', () => this.restartGame());
                this.elements.pauseBtn.addEventListener('click', () => this.togglePause());
                this.elements.resumeBtn.addEventListener('click', () => this.togglePause());
                this.elements.translationBtn.addEventListener('click', () => this.toggleTranslation());
                this.elements.musicBtn.addEventListener('click', () => this.toggleMusic());
                this.elements.loadCsvBtn.addEventListener('click', () => this.loadCustomWords());
                this.elements.clearCsvBtn.addEventListener('click', () => this.useDefaultWords());
                this.elements.normalModeBtn.addEventListener('click', () => this.setGameMode('normal'));
                this.elements.dictationModeBtn.addEventListener('click', () => this.setGameMode('dictation'));

                this.elements.wordInput.addEventListener('input', (e) => this.handleInput(e));
                this.elements.wordInput.addEventListener('keydown', (e) => this.handleKeydown(e));

                // Focus input when clicking on game area
                this.elements.gameArea.addEventListener('click', () => {
                    if (this.gameState.isPlaying && !this.gameState.isPaused) {
                        this.elements.wordInput.focus();
                    }
                });
            }

            startGame() {
                // Preserve translation setting and game mode
                const currentTranslationSetting = this.gameState.showTranslation;
                const currentGameMode = this.gameState.gameMode;
                const currentMusicEnabled = this.gameState.musicEnabled;

                this.gameState = {
                    isPlaying: true,
                    isPaused: false,
                    score: 0,
                    hp: 100,
                    maxHp: 100,
                    level: 1,
                    wordsTyped: 0,
                    totalCharacters: 0,
                    correctCharacters: 0,
                    startTime: Date.now(),
                    fallingWords: [],
                    wordIdCounter: 0,
                    showTranslation: currentTranslationSetting,
                    gameMode: currentGameMode,
                    healthItems: [],
                    musicEnabled: currentMusicEnabled
                };

                this.gameSpeed = 1;
                this.spawnRate = 4000;
                this.lastSpawnTime = 0;

                this.elements.startScreen.classList.add('hidden');
                this.elements.gameOverScreen.classList.add('hidden');
                this.elements.wordInput.focus();
                this.elements.wordInput.value = '';
                this.elements.currentTarget.textContent = 'Type the falling words!';

                // Clear any existing words
                this.elements.gameArea.innerHTML = '';

                // Start background music
                if (this.gameState.musicEnabled) {
                    this.playMusic();
                }

                this.updateStats();
                this.gameLoop();
            }

            playMusic() {
                this.elements.bgMusic.volume = 0.4; // Set volume to 40%
                this.elements.bgMusic.play().catch(err => {
                    console.log('Music autoplay failed:', err);
                    // Music will play when user interacts with the page
                });
            }

            stopMusic() {
                this.elements.bgMusic.pause();
                this.elements.bgMusic.currentTime = 0;
            }

            playGunshotSound() {
                // Reset the audio to start for rapid-fire typing
                this.elements.gunshotSound.currentTime = 0;
                this.elements.gunshotSound.play().catch(err => {
                    // Silently handle autoplay errors
                    console.log('Gunshot sound play failed:', err);
                });
            }

            toggleMusic() {
                this.gameState.musicEnabled = !this.gameState.musicEnabled;

                if (this.gameState.musicEnabled) {
                    this.elements.musicBtn.textContent = 'ğŸ”Š MUSIC';
                    this.elements.musicBtn.className = 'px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors';
                    if (this.gameState.isPlaying && !this.gameState.isPaused) {
                        this.playMusic();
                    }
                } else {
                    this.elements.musicBtn.textContent = 'ğŸ”‡ MUSIC';
                    this.elements.musicBtn.className = 'px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors';
                    this.stopMusic();
                }
            }

            restartGame() {
                this.startGame();
            }

            togglePause() {
                this.gameState.isPaused = !this.gameState.isPaused;

                if (this.gameState.isPaused) {
                    this.elements.pauseScreen.classList.remove('hidden');
                    this.elements.pauseBtn.textContent = 'RESUME';
                    // Pause music
                    if (this.gameState.musicEnabled) {
                        this.elements.bgMusic.pause();
                    }
                } else {
                    this.elements.pauseScreen.classList.add('hidden');
                    this.elements.pauseBtn.textContent = 'PAUSE';
                    this.elements.wordInput.focus();
                    // Resume music
                    if (this.gameState.musicEnabled) {
                        this.elements.bgMusic.play().catch(err => console.log('Music resume failed:', err));
                    }
                }
            }

            gameLoop() {
                if (!this.gameState.isPlaying) return;

                if (!this.gameState.isPaused) {
                    this.updateFallingWords();
                    this.spawnWord();
                    this.checkCollisions();
                    this.updateStats();
                }

                requestAnimationFrame(() => this.gameLoop());
            }

            spawnWord() {
                const now = Date.now();
                if (now - this.lastSpawnTime > this.spawnRate / this.gameSpeed) {
                    const word = this.getRandomWord();
                    this.createFallingWord(word);
                    this.lastSpawnTime = now;
                }
            }

            toggleTranslation() {
                this.gameState.showTranslation = !this.gameState.showTranslation;

                // Update button text
                this.elements.translationBtn.textContent = this.gameState.showTranslation ? 'ä¸­æ–‡ ON' : 'ä¸­æ–‡ OFF';
                this.elements.translationBtn.className = this.gameState.showTranslation ?
                    'px-3 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors text-sm' :
                    'px-3 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors text-sm';

                // Update existing words
                this.gameState.fallingWords.forEach(wordObj => {
                    this.updateWordDisplay(wordObj);
                });
            }

            getRandomWord() {
                const level = this.gameState.level;
                let availableWords;

                // For custom words, use all words regardless of level to ensure all uploaded words appear
                if (this.customWords && this.customWords.length > 0) {
                    availableWords = this.words;
                } else {
                    // For default words, use level-based filtering
                    if (level <= 2) {
                        // Easy words only
                        availableWords = this.words.filter(wordData => wordData.word.length <= 5);
                    } else if (level <= 5) {
                        // Easy and medium words
                        availableWords = this.words.filter(wordData => wordData.word.length <= 8);
                    } else {
                        // All words
                        availableWords = this.words;
                    }
                }

                return availableWords[Math.floor(Math.random() * availableWords.length)];
            }

            createFallingWord(wordData) {
                const wordElement = document.createElement('div');
                const zombieType = this.zombieTypes[Math.floor(Math.random() * this.zombieTypes.length)];

                wordElement.className = `absolute zombie-word ${zombieType}`;
                wordElement.id = `word-${this.gameState.wordIdCounter++}`;

                this.elements.gameArea.appendChild(wordElement);

                const wordObj = {
                    element: wordElement,
                    word: wordData.word,
                    translation: wordData.translation,
                    id: wordElement.id,
                    zombieType: zombieType,
                    damage: this.zombieStats[zombieType].damage,
                    typedLetters: 0,
                    isActive: false,
                    isHit: false,
                    isAttacking: false,
                    lastAttackTime: 0
                };

                this.gameState.fallingWords.push(wordObj);

                // Set up display with zombie image and text overlay
                this.updateWordDisplay(wordObj);

                // Calculate zombie size based on viewport (10vw)
                const zombieWidth = window.innerWidth * 0.1;
                const zombieHeight = window.innerWidth * 0.175;

                // Find a non-overlapping position
                let x, y, attempts = 0;
                let positionFound = false;
                const maxAttempts = 50;

                while (!positionFound && attempts < maxAttempts) {
                    // Random position in a circle around center
                    const centerX = this.elements.gameArea.clientWidth / 2;
                    const centerY = this.elements.gameArea.clientHeight / 2;
                    const angle = Math.random() * 2 * Math.PI;
                    const radius = Math.min(this.elements.gameArea.clientWidth, this.elements.gameArea.clientHeight) * 0.3;

                    x = centerX + Math.cos(angle) * radius - zombieWidth / 2;
                    y = centerY + Math.sin(angle) * radius - zombieHeight / 2;

                    // Constrain to game area
                    x = Math.max(0, Math.min(x, this.elements.gameArea.clientWidth - zombieWidth));
                    y = Math.max(80, Math.min(y, this.elements.gameArea.clientHeight - zombieHeight - 100));

                    // Check for overlap with existing zombies
                    positionFound = true;
                    for (let existingWordObj of this.gameState.fallingWords) {
                        if (existingWordObj.id === wordObj.id) continue; // Skip self

                        const existingRect = existingWordObj.element.getBoundingClientRect();
                        const newRect = {
                            left: x,
                            top: y,
                            right: x + zombieWidth,
                            bottom: y + zombieHeight
                        };

                        // Check for overlap with padding (add 20px buffer)
                        const buffer = 20;
                        if (!(newRect.right + buffer < existingRect.left ||
                              newRect.left - buffer > existingRect.right ||
                              newRect.bottom + buffer < existingRect.top ||
                              newRect.top - buffer > existingRect.bottom)) {
                            positionFound = false;
                            break;
                        }
                    }

                    attempts++;
                }

                wordElement.style.left = x + 'px';
                wordElement.style.top = y + 'px';

                // Animation duration based on level and zombie type
                // Significantly slowed down for better gameplay
                let baseDuration = Math.max(8, (10 - this.gameState.level * 0.5) * 2);

                // Zombie3 is faster
                if (zombieType === 'zombie3') {
                    baseDuration *= 0.75;
                }
                // Zombie2 is medium speed
                else if (zombieType === 'zombie2') {
                    baseDuration *= 0.9;
                }

                wordElement.style.animationDuration = baseDuration + 's';

                // Add zombie idle animation when approaching is complete
                setTimeout(() => {
                    if (wordElement.parentNode) {
                        wordElement.classList.add('zombie-idle');
                    }
                }, baseDuration * 1000);
            }

            updateWordDisplay(wordObj) {
                const word = wordObj.word;
                const translation = wordObj.translation;
                const zombieImage = this.zombieImages[wordObj.zombieType];

                if (this.gameState.gameMode === 'dictation') {
                    // Dictation mode: Show Chinese translation, hide English letters initially
                    const letterSpans = word.split('').map((letter, index) =>
                        `<span class="letter" data-index="${index}">_</span>`
                    ).join(' ');

                    wordObj.element.innerHTML = `
                        <div class="zombie-container">
                            <img src="${zombieImage}" alt="Zombie" class="zombie-image">
                            <div class="zombie-text-overlay">
                                <div class="text-gray-400 font-mono tracking-wider" style="font-size: 1vw;">${letterSpans}</div>
                                <div class="font-bold text-blue-600 dark:text-blue-400" style="margin-top: 0.4vw; font-size: 1vw;">${translation}</div>
                            </div>
                        </div>
                    `;
                } else {
                    // Normal mode: Show English word with optional translation
                    const letterSpans = word.split('').map((letter, index) =>
                        `<span class="letter" data-index="${index}">${letter}</span>`
                    ).join('');

                    const translationHtml = this.gameState.showTranslation ?
                        `<div class="text-gray-600 dark:text-gray-400" style="margin-top: 0.3vw; font-size: 0.9vw;">(${translation})</div>` : '';

                    wordObj.element.innerHTML = `
                        <div class="zombie-container">
                            <img src="${zombieImage}" alt="Zombie" class="zombie-image">
                            <div class="zombie-text-overlay">
                                <div class="font-bold" style="font-size: 1.1vw;">${letterSpans}</div>
                                ${translationHtml}
                            </div>
                        </div>
                    `;
                }
            }

            updateFallingWords() {
                const now = Date.now();

                this.gameState.fallingWords = this.gameState.fallingWords.filter(wordObj => {
                    const element = wordObj.element;
                    const computedStyle = window.getComputedStyle(element);
                    const transform = computedStyle.transform;

                    // Check if animation has reached dangerous proximity (scale > 1.2 means very close)
                    if (transform && transform !== 'none') {
                        const matrix = new DOMMatrix(transform);
                        const scaleX = Math.sqrt(matrix.a * matrix.a + matrix.b * matrix.b);

                        if (scaleX >= 1.4) {
                            // Zombie reached the player
                            if (!wordObj.isAttacking) {
                                // First time reaching player - pause and attack
                                wordObj.isAttacking = true;
                                wordObj.lastAttackTime = now;
                                element.style.animationPlayState = 'paused';

                                // First attack
                                this.takeDamage(wordObj.damage);

                                // Add attacking visual effect
                                element.style.filter = 'brightness(1.3) drop-shadow(0 0 20px #ff0000)';
                            } else {
                                // Continue attacking every 2 seconds
                                if (now - wordObj.lastAttackTime >= 2000) {
                                    wordObj.lastAttackTime = now;
                                    this.takeDamage(wordObj.damage);

                                    // Attack flash effect
                                    element.style.filter = 'brightness(2) drop-shadow(0 0 30px #ff0000)';
                                    setTimeout(() => {
                                        if (element.parentNode) {
                                            element.style.filter = 'brightness(1.3) drop-shadow(0 0 20px #ff0000)';
                                        }
                                    }, 200);
                                }
                            }
                        }
                    }

                    return true;
                });
            }

            handleInput(e) {
                if (!this.gameState.isPlaying || this.gameState.isPaused) return;

                const input = e.target.value.toLowerCase();

                // Clear all visual states first
                this.gameState.fallingWords.forEach(wordObj => {
                    wordObj.isActive = false;
                    const letters = wordObj.element.querySelectorAll('.letter');
                    letters.forEach(letter => {
                        letter.classList.remove('typed', 'current');
                    });
                    // Remove highlight
                    const overlay = wordObj.element.querySelector('.zombie-text-overlay');
                    if (overlay) {
                        overlay.classList.remove('border-yellow-500', 'bg-yellow-50', 'dark:bg-yellow-900/20');
                    }
                });

                if (!input) {
                    this.elements.currentTarget.textContent = 'Type the approaching words!';
                    return;
                }

                // Find the best matching word (most letters typed correctly)
                let bestMatch = null;
                let maxCorrectLetters = 0;

                this.gameState.fallingWords.forEach(wordObj => {
                    const word = wordObj.word.toLowerCase();
                    let correctLetters = 0;

                    for (let i = 0; i < Math.min(input.length, word.length); i++) {
                        if (input[i] === word[i]) {
                            correctLetters++;
                        } else {
                            break;
                        }
                    }

                    if (correctLetters > maxCorrectLetters) {
                        maxCorrectLetters = correctLetters;
                        bestMatch = wordObj;
                    }
                });

                if (bestMatch && maxCorrectLetters > 0) {
                    bestMatch.isActive = true;

                    const letters = bestMatch.element.querySelectorAll('.letter');
                    const word = bestMatch.word.toLowerCase();

                    // Check if this is a new letter hit (zombie gets shot!)
                    if (maxCorrectLetters > bestMatch.typedLetters) {
                        this.triggerZombieHitEffect(bestMatch);
                        this.playGunshotSound(); // Play gunshot sound on each correct letter
                    }

                    bestMatch.typedLetters = maxCorrectLetters;

                    // In dictation mode, reveal typed letters
                    if (this.gameState.gameMode === 'dictation') {
                        for (let i = 0; i < word.length; i++) {
                            if (i < maxCorrectLetters) {
                                // Show correctly typed letters
                                letters[i].textContent = word[i];
                                letters[i].classList.add('typed');
                            } else if (i === maxCorrectLetters) {
                                // Show current letter to type
                                letters[i].textContent = '_';
                                letters[i].classList.add('current');
                            } else {
                                // Keep remaining letters hidden
                                letters[i].textContent = '_';
                            }
                        }
                    } else {
                        // Normal mode behavior
                        for (let i = 0; i < maxCorrectLetters; i++) {
                            letters[i].classList.add('typed');
                        }

                        if (maxCorrectLetters < word.length) {
                            letters[maxCorrectLetters].classList.add('current');
                        }
                    }

                    // Check if word is complete
                    if (input === word) {
                        this.destroyWord(bestMatch);
                        e.target.value = '';
                        return;
                    }

                    // Check if there's an incorrect letter
                    if (input.length > maxCorrectLetters) {
                        this.handleIncorrectLetter();
                        return;
                    }

                    this.elements.currentTarget.textContent = `Typing: ${bestMatch.word} (${maxCorrectLetters}/${word.length})`;

                    // Highlight the active word overlay
                    const overlay = bestMatch.element.querySelector('.zombie-text-overlay');
                    if (overlay) {
                        overlay.classList.add('border-yellow-500', 'bg-yellow-50', 'dark:bg-yellow-900/20');
                    }
                } else if (input.length > 0) {
                    this.handleIncorrectLetter();
                }
            }

            handleKeydown(e) {
                // Allow space in words, but handle Enter to clear input if needed
                if (e.key === 'Escape') {
                    e.preventDefault();
                    this.elements.wordInput.value = '';
                    this.elements.currentTarget.textContent = 'Input cleared!';
                }
            }

            triggerZombieHitEffect(wordObj) {
                // Prevent animation stacking
                if (wordObj.isHit) return;

                // Remove any existing hit effects
                wordObj.element.classList.remove('hit-stun', 'hit-knockback');

                // Randomly choose between stun and knockback (70% stun, 30% knockback)
                const hitType = Math.random() < 0.7 ? 'stun' : 'knockback';

                if (hitType === 'stun') {
                    wordObj.element.classList.add('hit-stun');
                    // Remove the class after animation completes
                    setTimeout(() => {
                        if (wordObj.element.parentNode) {
                            wordObj.element.classList.remove('hit-stun');
                        }
                    }, 300);
                } else {
                    // Knockback: pause the zombie's approach animation
                    const currentAnimation = wordObj.element.style.animation;
                    wordObj.element.style.animationPlayState = 'paused';

                    wordObj.element.classList.add('hit-knockback');

                    // After knockback animation completes, resume approach from new position
                    setTimeout(() => {
                        if (wordObj.element.parentNode) {
                            // Remove knockback class to allow approach animation to continue
                            wordObj.element.classList.remove('hit-knockback');
                            // Resume the approach animation
                            wordObj.element.style.animationPlayState = 'running';
                        }
                    }, 600);
                }

                // Mark as hit to prevent animation stacking
                wordObj.isHit = true;
                setTimeout(() => {
                    wordObj.isHit = false;
                }, 700);
            }

            destroyWord(wordObj) {
                // Get zombie position before death animation
                const rect = wordObj.element.getBoundingClientRect();
                const dropX = rect.left + rect.width / 2;
                const dropY = rect.top + rect.height / 2;

                // Zombie death animation
                wordObj.element.classList.add('zombie-death');

                setTimeout(() => {
                    wordObj.element.remove();
                }, 800);

                // Calculate score based on word length
                const points = wordObj.word.length * 10 * this.gameState.level;
                this.gameState.score += points;
                this.gameState.wordsTyped++;
                this.gameState.correctCharacters += wordObj.word.length;
                this.gameState.totalCharacters += wordObj.word.length;

                // 5% chance to drop health item
                if (Math.random() < 0.05) {
                    this.dropHealthItem(dropX, dropY);
                }

                // Remove from falling words array
                this.gameState.fallingWords = this.gameState.fallingWords.filter(w => w.id !== wordObj.id);

                // Check for level up
                if (this.gameState.wordsTyped % 10 === 0) {
                    this.levelUp();
                }

                this.elements.currentTarget.textContent = 'Zombie eliminated!';
                setTimeout(() => {
                    if (this.gameState.isPlaying) {
                        this.elements.currentTarget.textContent = 'Keep shooting!';
                    }
                }, 1000);
            }

            dropHealthItem(x, y) {
                const item = document.createElement('div');
                item.className = 'health-item';
                item.innerHTML = '<img src="images/Medicine.png" alt="Health Pack">';
                item.style.left = (x - 50) + 'px'; // Center the 100px item
                item.style.top = (y - 50) + 'px';

                const itemId = 'health-' + Date.now();
                item.id = itemId;

                this.elements.gameArea.appendChild(item);

                // Add to health items array
                this.gameState.healthItems.push({
                    id: itemId,
                    element: item,
                    x: x,
                    y: y
                });

                // Auto-collect after 1 second (ç»™ç©å®¶çœ‹åˆ°æ‰è½çš„æ—¶é—´)
                setTimeout(() => {
                    if (document.getElementById(itemId)) {
                        this.collectHealthItem(itemId);
                    }
                }, 1000);
            }

            collectHealthItem(itemId) {
                const item = this.gameState.healthItems.find(h => h.id === itemId);
                if (!item) return;

                const healAmount = 20;

                // Add collecting animation
                const element = item.element;
                element.classList.add('collecting');

                // Heal after a short delay for visual effect
                setTimeout(() => {
                    this.healHP(healAmount);
                }, 200);

                // Remove element after animation
                setTimeout(() => {
                    element.remove();
                }, 800);

                // Remove from array
                this.gameState.healthItems = this.gameState.healthItems.filter(h => h.id !== itemId);

                this.elements.currentTarget.textContent = 'ğŸ’š +20 HP!';
                setTimeout(() => {
                    if (this.gameState.isPlaying) {
                        this.elements.currentTarget.textContent = 'Keep typing!';
                    }
                }, 1500);
            }

            handleIncorrectLetter() {
                const input = this.elements.wordInput;
                input.classList.add('shake');
                input.style.borderColor = '#ef4444';

                setTimeout(() => {
                    input.classList.remove('shake');
                    input.style.borderColor = '';
                    // Players must manually correct their mistakes (no auto-delete)
                }, 200);

                this.elements.currentTarget.textContent = 'Wrong letter! Press Backspace to correct!';
            }

            handleMiss() {
                const input = this.elements.wordInput;
                input.classList.add('shake');
                input.style.borderColor = '#ef4444';

                this.gameState.totalCharacters += input.value.length;

                setTimeout(() => {
                    input.classList.remove('shake');
                    input.style.borderColor = '';
                    input.value = '';
                }, 300);

                this.elements.currentTarget.textContent = 'Miss! Try again!';
            }

            takeDamage(damage) {
                this.gameState.hp = Math.max(0, this.gameState.hp - damage);
                this.updateHP(false); // false = damage

                if (this.gameState.hp <= 0) {
                    this.gameOver();
                }
            }

            healHP(amount) {
                this.gameState.hp = Math.min(this.gameState.maxHp, this.gameState.hp + amount);
                this.updateHP(true); // true = heal
            }

            updateHP(isHeal = false) {
                const hpPercentage = (this.gameState.hp / this.gameState.maxHp) * 100;
                this.elements.hpBar.style.width = hpPercentage + '%';
                this.elements.hpText.textContent = `${this.gameState.hp} / ${this.gameState.maxHp}`;

                // Update HP bar color based on health
                if (hpPercentage > 60) {
                    this.elements.hpBar.className = 'absolute top-0 left-0 h-full bg-gradient-to-r from-green-500 to-green-600 transition-all duration-300 ease-out';
                } else if (hpPercentage > 30) {
                    this.elements.hpBar.className = 'absolute top-0 left-0 h-full bg-gradient-to-r from-yellow-500 to-orange-500 transition-all duration-300 ease-out';
                } else {
                    this.elements.hpBar.className = 'absolute top-0 left-0 h-full bg-gradient-to-r from-red-500 to-red-600 transition-all duration-300 ease-out';
                }

                // Add animation effect
                if (isHeal) {
                    this.elements.hpBar.classList.add('hp-heal');
                    setTimeout(() => {
                        this.elements.hpBar.classList.remove('hp-heal');
                    }, 600);
                } else {
                    this.elements.hpBar.classList.add('hp-damage');
                    setTimeout(() => {
                        this.elements.hpBar.classList.remove('hp-damage');
                    }, 500);

                    // Screen flash on damage
                    document.body.style.background = '#fee2e2';
                    setTimeout(() => {
                        document.body.style.background = '';
                    }, 200);
                }
            }

            levelUp() {
                this.gameState.level++;

                // Gentler difficulty curve
                // gameSpeed increases slowly: 1.0 -> 1.5 (caps at level 11)
                this.gameSpeed = Math.min(1.5, 1 + (this.gameState.level - 1) * 0.05);

                // spawnRate decreases gradually: 4000ms -> 600ms (caps at level 23)
                this.spawnRate = Math.max(600, 4000 - (this.gameState.level - 1) * 150);

                // Visual feedback
                this.elements.currentTarget.textContent = `LEVEL UP! Level ${this.gameState.level}`;
                setTimeout(() => {
                    if (this.gameState.isPlaying) {
                        this.elements.currentTarget.textContent = 'Keep typing!';
                    }
                }, 2000);
            }

            checkCollisions() {
                // This function is no longer needed as zombies now stop and attack
                // Attack logic is handled in updateFallingWords()
            }

            updateStats() {
                this.elements.score.textContent = this.gameState.score.toLocaleString();
                this.elements.level.textContent = this.gameState.level;

                // Update HP bar
                const hpPercentage = (this.gameState.hp / this.gameState.maxHp) * 100;
                this.elements.hpBar.style.width = hpPercentage + '%';
                this.elements.hpText.textContent = `${this.gameState.hp} / ${this.gameState.maxHp}`;

                // Calculate WPM
                const timeElapsed = (Date.now() - this.gameState.startTime) / 60000; // minutes
                const wpm = timeElapsed > 0 ? Math.round(this.gameState.wordsTyped / timeElapsed) : 0;
                this.elements.wpm.textContent = wpm;

                // Calculate accuracy
                const accuracy = this.gameState.totalCharacters > 0 ?
                    Math.round((this.gameState.correctCharacters / this.gameState.totalCharacters) * 100) : 100;
                this.elements.accuracy.textContent = accuracy + '%';
            }

            loadCustomWords() {
                const fileInput = this.elements.csvFileInput;
                if (!fileInput.files || !fileInput.files[0]) {
                    this.showCsvStatus('Please select a CSV file first.', 'error');
                    return;
                }

                const file = fileInput.files[0];
                const reader = new FileReader();

                reader.onload = (e) => {
                    try {
                        const csvText = e.target.result;
                        console.log('CSV Text:', csvText); // Debug
                        const customWords = this.parseCSV(csvText);
                        console.log('Parsed words:', customWords); // Debug

                        if (customWords.length === 0) {
                            this.showCsvStatus('No valid words found in CSV file. Please check format: word,translation', 'error');
                            return;
                        }

                        this.customWords = customWords;
                        this.words = customWords;

                        this.showCsvStatus(`Successfully loaded ${customWords.length} words from CSV.`, 'success');
                        this.elements.wordSource.textContent = 'CUSTOM';
                        this.elements.wordSource.className = 'text-sm font-bold text-blue-500';

                        // Show game mode selection when custom words are loaded
                        this.elements.gameModeSection.classList.remove('hidden');

                    } catch (error) {
                        console.error('CSV parsing error:', error);
                        this.showCsvStatus('Error reading CSV file: ' + error.message, 'error');
                    }
                };

                reader.onerror = () => {
                    this.showCsvStatus('Error reading file.', 'error');
                };

                // Specify UTF-8 encoding to handle Chinese characters
                reader.readAsText(file, 'UTF-8');
            }

            parseCSV(csvText) {
                const lines = csvText.split('\n').filter(line => line.trim());
                const words = [];

                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;

                    // Split by comma and handle quoted values
                    const parts = this.splitCSVLine(line);

                    if (parts.length >= 1) {
                        const word = parts[0].trim();
                        const translation = parts.length > 1 ? parts[1].trim() : word;

                        // Validate word (only letters and basic punctuation)
                        if (word && /^[a-zA-Z\s\-']+$/.test(word)) {
                            words.push({
                                word: word.toLowerCase(),
                                translation: translation || word
                            });
                        }
                    }
                }

                return words;
            }

            splitCSVLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;

                for (let i = 0; i < line.length; i++) {
                    const char = line[i];

                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current);
                        current = '';
                    } else {
                        current += char;
                    }
                }

                result.push(current);
                return result;
            }

            useDefaultWords() {
                this.customWords = null;
                this.words = [...this.defaultWords];

                this.showCsvStatus('Using default word list.', 'success');
                this.elements.wordSource.textContent = 'DEFAULT';
                this.elements.wordSource.className = 'text-sm font-bold text-orange-500';

                // Hide game mode selection when using default words
                this.elements.gameModeSection.classList.add('hidden');
                this.setGameMode('normal');

                // Clear file input
                this.elements.csvFileInput.value = '';
            }

            setGameMode(mode) {
                this.gameState.gameMode = mode;

                // Update UI
                if (mode === 'normal') {
                    this.elements.gameMode.textContent = 'NORMAL';
                    this.elements.gameMode.className = 'text-sm font-bold text-purple-500';
                    this.elements.normalModeBtn.className = 'px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors text-sm';
                    this.elements.dictationModeBtn.className = 'px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500 transition-colors text-sm';

                    // Show translation button in normal mode
                    this.elements.translationBtn.style.display = 'block';
                } else if (mode === 'dictation') {
                    this.elements.gameMode.textContent = 'DICTATION';
                    this.elements.gameMode.className = 'text-sm font-bold text-pink-500';
                    this.elements.dictationModeBtn.className = 'px-4 py-2 bg-pink-500 text-white rounded hover:bg-pink-600 transition-colors text-sm';
                    this.elements.normalModeBtn.className = 'px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500 transition-colors text-sm';

                    // Hide translation button in dictation mode (always show Chinese)
                    this.elements.translationBtn.style.display = 'none';
                }

                // Update existing words if in game
                if (this.gameState.isPlaying) {
                    this.gameState.fallingWords.forEach(wordObj => {
                        this.updateWordDisplay(wordObj);
                    });
                }
            }

            showCsvStatus(message, type) {
                const statusElement = this.elements.csvStatus;
                statusElement.textContent = message;

                if (type === 'success') {
                    statusElement.className = 'text-sm text-green-600 dark:text-green-400';
                } else if (type === 'error') {
                    statusElement.className = 'text-sm text-red-600 dark:text-red-400';
                } else {
                    statusElement.className = 'text-sm text-gray-600 dark:text-gray-400';
                }

                // Clear status after 3 seconds
                setTimeout(() => {
                    statusElement.textContent = '';
                }, 3000);
            }

            gameOver() {
                this.gameState.isPlaying = false;

                // Stop music
                this.stopMusic();

                // Clear all falling words
                this.gameState.fallingWords.forEach(wordObj => wordObj.element.remove());
                this.gameState.fallingWords = [];

                // Show final stats
                const timeElapsed = (Date.now() - this.gameState.startTime) / 60000;
                const finalWpm = timeElapsed > 0 ? Math.round(this.gameState.wordsTyped / timeElapsed) : 0;
                const finalAccuracy = this.gameState.totalCharacters > 0 ?
                    Math.round((this.gameState.correctCharacters / this.gameState.totalCharacters) * 100) : 100;

                this.elements.finalScore.textContent = this.gameState.score.toLocaleString();
                this.elements.finalWpm.textContent = finalWpm;
                this.elements.finalAccuracy.textContent = finalAccuracy + '%';
                this.elements.finalLevel.textContent = this.gameState.level;

                this.elements.gameOverScreen.classList.remove('hidden');
            }
        }

        // Start the game when page loads
        window.addEventListener('load', () => {
            new TypingGame();
        });
    </script>
</body>
</html>

